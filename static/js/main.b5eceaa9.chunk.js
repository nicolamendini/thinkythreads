(this.webpackJsonpthinkythreads=this.webpackJsonpthinkythreads||[]).push([[2],{12:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return h})),n.d(t,"i",(function(){return p})),n.d(t,"e",(function(){return b})),n.d(t,"f",(function(){return g})),n.d(t,"k",(function(){return v})),n.d(t,"h",(function(){return O})),n.d(t,"c",(function(){return j})),n.d(t,"g",(function(){return k})),n.d(t,"j",(function(){return I})),n.d(t,"d",(function(){return w}));var o=n(4),r=n(8),i=n(7),c=n(11),a=n(13),s=n(6),d=n(5),l=n(17),u=n(15);function f(e,t,n){e.openedWorkspaceId===t||(e.workspaceIds=Object(d.a)(e.workspaceIds,n,t))}function h(e,t,n,o){var r=!e.branches.includes(t.id),i=e.id!==t.id,c=e.branches.length<a.a,s=!t.roots.includes(e.id),l=t.roots.length<a.a;if(i&&c&&l){var u=!1;if(void 0!==n?o?(r&&(u=!0,e.branches.push(t.id)),s&&(u=!0,t.roots=Object(d.a)(t.roots,n,e.id))):(r&&(u=!0,e.branches=Object(d.a)(e.branches,n,t.id)),s&&(u=!0,t.roots.push(e.id))):(r&&(u=!0,e.branches.push(t.id)),s&&(u=!0,t.roots.push(e.id))),u)return!0}}function p(e,t,n){var o,r=Object(c.a)(e.notes);try{for(r.s();!(o=r.n()).done;)for(var a=Object(i.a)(o.value,2)[1],s=1;s<a.thread.length;s++)if(a.thread[s-1]===t.id&&a.thread[s]===n.id)return Object(u.b)("The link you are tying to delete is used in the Thread : "+Object(d.h)(a)+"... \nPlease restructure this Thread it if you desire to proceed."),!1}catch(f){r.e(f)}finally{r.f()}var l=t.branches.findIndex((function(e){return e===n.id}));return-1!==l&&(t.branches=Object(d.l)(t.branches,l)),-1!==(l=n.roots.findIndex((function(e){return e===t.id})))&&(n.roots=Object(d.l)(n.roots,l)),!0}function b(e,t,n){var o,r=!1,a=0,d=Object(c.a)(e.notes);try{var l=function(){var c=Object(i.a)(o.value,2)[1];c.branches.includes(t)&&(c.branches=c.branches.filter((function(e){return e!==t})),r=!0),c.roots.includes(t)&&(c.roots=c.roots.filter((function(e){return e!==t})),r=!0),c.thread.includes(t)&&(c.thread=c.thread.filter((function(e){return e!==t})),g(e,c.thread,n),r=!0),r&&setTimeout((function(){Object(s.a)(c,"meta",n)}),200*(a+=1)),r=!1};for(d.s();!(o=d.n()).done;)l()}catch(u){d.e(u)}finally{d.f()}}function g(e,t,n){for(var o=0,r=function(r){var i=e.notes.get(t[r-1]),c=e.notes.get(t[r]);h(i,c)&&setTimeout((function(){Object(s.a)(i,"meta",n),Object(s.a)(c,"meta",n)}),200*(o+=1))},i=1;i<t.length;i++)r(i)}function v(e,t,n,o){if(!e.notes.get(t).thread.length&&!e.notes.get(t).collection.length)if(e.workspaceIds.includes(t))Object(u.b)(l.b);else{var r=e.notes.get(t);o?(r.thread=e.workspaceIds,g(e,r.thread,n)):r.collection=e.workspaceIds,e.prevSelectedNoteId=e.selectedNoteId,e.selectedNoteId=t,O(o,e,n,o),Object(s.a)(r,"meta",n)}}function O(e,t,n,o,i){j(t,n,o),i||(i=t.notes.get(t.selectedNoteId)),t.workspaceIds=e?Object(r.a)(i.thread):Object(r.a)(i.collection),t.openedWorkspaceId=i.id}function j(e,t,n){if(e.openedWorkspaceId){var o=e.notes.get(e.openedWorkspaceId),r=!1;n?(r=Object(d.b)(o.thread,e.workspaceIds),o.thread=e.workspaceIds,g(e,o.thread,t)):(r=Object(d.b)(o.collection,e.workspaceIds))&&(o.collection=e.workspaceIds),r&&Object(s.a)(o,"meta",t),e.openedWorkspaceId=null}e.workspaceIds=[]}function k(e,t,n,r,i,c){if(t)e.id!==r.selectedNoteId?e.thread.length&&r.notes.get(r.selectedNoteId).collection.length||r.notes.get(r.selectedNoteId).thread.length&&e.collection.length?Object(u.b)(l.g):c(r.notes.get(r.selectedNoteId),e):n(!1);else if(!r.selectedNoteId||r.selectedNoteId!==e.id){var a=document.getElementById("search-bar");a&&a.blur();var s=Object(o.a)({},r);s.prevSelectedNoteId=s.selectedNoteId,s.selectedNoteId=e.id,r.selectedNoteId=e.id,i(s,!1,!1,!0,!0)}}function I(e){e.collection=Object(r.a)(new Set(Object(r.a)(e.thread))),e.thread=[]}function w(e){e.thread=e.collection,e.collection=[]}},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y})),n.d(t,"f",(function(){return $})),n.d(t,"e",(function(){return _})),n.d(t,"b",(function(){return Q})),n.d(t,"d",(function(){return X})),n.d(t,"i",(function(){return Z})),n.d(t,"j",(function(){return ee})),n.d(t,"g",(function(){return te})),n.d(t,"c",(function(){return ne}));var o=n(9),r=n.n(o),i=n(16),c=n(11),a=n(4),s=n(7),d=n(1),l=n.n(d),u=n(128),f=n(5),h=n(18),p=n(6);function b(e,t,n,o,r,i,c,a){a||(a=0),Object(p.e)(n.result.files[o].id).then((function(a){return function(e,t,n,o,r,i,c,a){var s=JSON.parse(n.result.files[r].description);if(s.text=o.body,s.text){if(s.version=parseInt(n.result.files[r].appProperties.version),e.notes.set(s.id,s),!s.leftLink){var d=e.notes.get(e.firstNoteId);d&&(d.leftLink=s.id,d.version+=1,te.notes.update(d.id,d)),e.firstNoteId=s.id,console.log("added first note",s.id)}te.notes.put(s).then(Object(f.e)(s))}else Object(h.c)(n.result.files[r].id,i);a.count+=1,i((function(e){return e-1})),a.count===n.result.files.length&&(n.result.nextPageToken?g(e,t,i,c,n.result.nextPageToken):(console.log("chiamato qui 2"),v(e,t,i,c)))}(e,t,n,a,o,r,i,c)})).catch((function(s){return Object(p.c)(s,a,b,e,t,n,o,r,i,c)}))}function g(e,t,n,o,r,i){i||(i=0),window.gapi.client.drive.files.list({fields:"nextPageToken, files(description, id, name, appProperties)",q:"mimeType='application/json' and trashed=false and '"+Z.folderId+"' in parents",pageToken:r}).then((function(r){!function(e,t,n,o,r){for(var i={count:0},c=0;c<n.result.files.length;c++){var a=n.result.files[c],s=a.name;if("true"===a.appProperties.deleted)e.notes.get(s)&&(e.notes.delete(s),te.notes.delete(s),Object(f.n)(e,s),console.log("deleted first note",s)),i.count+=1;else{var d=parseInt(a.appProperties.version);t[s]=d;var l=e.notes.get(s);!l||d>l.version?(b(e,t,n,c,o,r,i),o((function(e){return e+1}))):i.count+=1}}i.count===n.result.files.length&&(n.result.nextPageToken?g(e,t,o,r,n.result.nextPageToken):v(e,t,o,r))}(e,t,r,n,o)})).catch((function(c){return Object(p.c)(c,i,g,e,t,n,o,r)}))}function v(e,t,n,o){var r,i=0,a=Object(c.a)(e.notes);try{for(a.s();!(r=a.n()).done;){var d=Object(s.a)(r.value,2),l=d[0],u=d[1],f=t[l];(!f||f<u.version)&&(i+=1,Object(p.h)(l,i,n)),u.leftLink||(e.firstNoteId=u.id)}}catch(h){a.e(h)}finally{a.f()}e.checkedAgainstDrive=!0,console.log("setting dashboard"),o(e)}var O=n(8),j=function(e,t,n){if(e){var o=[];e.preview.replace(/(<([^>]+)>)/gi,"").toLowerCase().includes(t.searchText)&&(o=[e],t.imgFilter&&!e.attachedImg&&(o=[]),o.length&&"#ededed"!==t.colorFilter&&t.colorFilter!==e.colorPreview&&(o=[]),o.length&&t.collectionFilter&&t.threadFilter?e.thread.length||e.collection.length||(o=[]):o.length&&t.threadFilter?e.thread.length||(o=[]):o.length&&t.collectionFilter&&(e.collection.length||(o=[])),o.length&&(e.pinned?n.notes=[Object(f.d)(o[0])].concat(Object(O.a)(n.notes)):n.notes=[].concat(Object(O.a)(n.notes),[Object(f.d)(o[0])])))}else console.log("exceeded")};function k(e,t){return t.filter((function(t,n){return!e.includes(n)}))}function I(e,t,n,o,r){return e.notes.get(t)?[Object(f.d)(e.notes.get(t))]:(o.push(n),function(e,t,n){window.alert("-------- BETA VERSION ERROR REPORT ------- \n---- PLEASE SHARE WITH THE DEVELOPER --- \nalong with some info about what you did to get here \nEMAIL: nicolamendini0@gmail.com \nTHANK YOU!\n\nERROR: \n"+e+"\n\nNOTE: \n"+t+"\n\n\nNOTES-ORDER: \n"+n.notesOrder+"\n\nLINKS: \n"+n.links+"\n\nWORKSPACE-IDS: \n"+n.workspaceIds)}(r,t,e),[])}var w=function(e,t,n){t.n+=1,setTimeout((function(){n(e,"meta")}),200*t.n)};n(226);var m=n(130),N=n.n(m),y=n(12),x=n(17),S=n(15);function L(e,t,n,o,r,i,c,s,d){if(null!==d.destination)if(t)Object(S.b)(x.a);else if("search-area"===d.source.droppableId){if("workspace-area"===d.destination.droppableId)T(e,n,e.search[d.source.index].id,c,d.destination.index);else if("branches-area"===d.destination.droppableId){var l=Object(a.a)({},e),u=l.notes.get(e.search[d.source.index].id);P(u,d,e,l,r,p.a,i),c(l)}else if("wrapper-area"===d.destination.droppableId){var h=Object(a.a)({},e);M(h,e.search[d.source.index],n,o,i),c(h)}else if("search-area"===d.destination.droppableId){if(d.source.index!==d.destination.index)if(e.openedCollectionId){var b=Object(a.a)({},e),g=b.notes.get(b.openedCollectionId);g&&(g.collection=Object(f.j)(g.collection,d.source.index,d.destination.index),c(b,!0),Object(p.a)(g,"meta",i))}else{var v=e.search[d.source.index],O=e.search[d.destination.index],j=d.source.index>d.destination.index;if(!(!O.pinned&&v.pinned||!v.pinned&&O.pinned)){var k=Object(a.a)({},e);v.pinned&&(j=!j),Object(f.k)(k,v.id,O.id,j,(function(e){return Object(p.a)(e,"meta",i)})),k.prevSelectedNoteId=k.selectedNoteId,k.selectedNoteId=v.id,c(k,!0,!1,!0)}}}else if("search-bar"===d.destination.droppableId){E(Object(a.a)({},e),s,c,e.search[d.source.index])}}else if("workspace-area"===d.source.droppableId){if("search-area"===d.destination.droppableId)C(Object(a.a)({},e),n,c,d.source.index);else if("workspace-area"===d.destination.droppableId){var I=Object(a.a)({},e);I.workspaceIds=Object(f.j)(I.workspaceIds,d.source.index,d.destination.index),I.prevSelectedNoteId=I.selectedNoteId,I.selectedNoteId=I.workspaceIds[d.destination.index],c(I,!1,!0,!0)}else if("wrapper-area"===d.destination.droppableId){var w=Object(a.a)({},e);M(w,e.workspace[d.source.index],n,o,i),c(w)}else if("search-bar"===d.destination.droppableId){E(Object(a.a)({},e),s,c,e.workspace[d.source.index])}else if("branches-area"===d.destination.droppableId){var m=Object(a.a)({},e),N=m.notes.get(e.workspace[d.source.index].id);P(N,d,e,m,r,p.a,i),c(m)}}else if("branches-area"===d.source.droppableId)if("search-area"===d.destination.droppableId){var L=Object(a.a)({},e),D=L.notes.get(e.links[d.source.index].id),F=L.notes.get(e.selectedNoteId);r?Object(y.i)(L,D,F)&&(Object(p.a)(F,"meta",i),Object(p.a)(D,"meta",i)):Object(y.i)(L,F,D)&&(Object(p.a)(F,"meta",i),Object(p.a)(D,"meta",i)),c(L)}else if("workspace-area"===d.destination.droppableId){T(e,n,e.links[d.source.index].id,c,d.destination.index)}else if("wrapper-area"===d.destination.droppableId){var A=Object(a.a)({},e);M(A,e.links[d.source.index],n,o,i),c(A)}else if("branches-area"===d.destination.droppableId){if(d.source.index!==d.destination.index){var U=Object(a.a)({},e),W=U.notes.get(U.selectedNoteId);r?W.roots=Object(f.j)(W.roots,d.source.index,d.destination.index):W.branches=Object(f.j)(W.branches,d.source.index,d.destination.index),Object(p.a)(W,"meta",i),c(U,!1,!1,!0)}}else if("search-bar"===d.destination.droppableId){E(Object(a.a)({},e),s,c,e.links[d.source.index])}}var P=function(e,t,n,o,r,i,c){var a=o.notes.get(n.selectedNoteId);r?Object(y.a)(e,a,t.destination.index,r)&&(i(a,"meta",c),i(e,"meta",c)):Object(y.a)(a,e,t.destination.index,r)&&(i(a,"meta",c),i(e,"meta",c))};function T(e,t,n,o,r){if(void 0!==r&&null!==r||(r=e.workspaceIds.length),e.workspaceIds.length>$)Object(S.b)(x.m);else if(t){var i=Object(a.a)({},e);Object(y.b)(i,n,r),o(i,!1,!0,!0)}else if((!e.openedWorkspaceId||e.openedWorkspaceId!==n)&&!e.workspaceIds.includes(n)){var c=Object(a.a)({},e);c.workspaceIds=Object(f.a)(c.workspaceIds,r,n),o(c,!1,!0)}}function C(e,t,n,o){e.workspaceIds=Object(f.l)(e.workspaceIds,o),n(e,!1,!0,!0)}function E(e,t,n,o){ne.resetSearchScroll=!0,e.openedCollectionId=o.id,t(Object(a.a)({},ee)),n(e,!0)}function M(e,t,n,o,r){e.workspaceIds.length>0&&!e.openedWorkspaceId?Object(y.k)(e,t.id,r,n):t.thread.length?(Object(y.h)(!0,e,r,n,t),o(!0)):t.collection.length?(Object(y.h)(!1,e,r,n,t),o(!1)):Object(y.h)(n,e,r,n,t)}function D(e,t,n,o,r,i,c){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(r.a.mark((function e(t,n,o,i,a,d,l){var u,b,g,v,O,j;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=o.notes.get(t),Object(f.c)(o,t)||i){if(Object(f.g)(o,u,(function(e){return Object(p.a)(e,"meta",d)})),o.notes.delete(t),u.deleted=!0,i)a(!1);else{b=0,g=Object(c.a)(o.notes);try{for(O=function(){var e=Object(s.a)(v.value,2)[1],n=e.collection.findIndex((function(e){return e===t}));-1!==n&&(e.collection=Object(f.l)(e.collection,n),b+=1,setTimeout((function(){Object(p.a)(e,"meta",d)}),200*b))},g.s();!(v=g.n()).done;)O()}catch(r){g.e(r)}finally{g.f()}Object(f.n)(o,t)}Z.authorisation&&Object(h.d)(u,"meta",d),te.notes.delete(t),n&&-1!==(j=o.search.findIndex((function(e){return e.id===t})))&&(o.search[j+1]?o.selectedNoteId=o.search[j+1].id:j>0&&o.search[j-1]&&(o.selectedNoteId=o.search[j-1].id)),l(o)}else Object(y.e)(o,t,d),D(t,!1,o,i,a,d,l);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n,o,r,i,d,l){var u=Object(O.a)(new Set([].concat(Object(O.a)(e.branches),Object(O.a)(t.branches)))),h=Object(O.a)(new Set([].concat(Object(O.a)(e.roots),Object(O.a)(t.roots)))),b=Object(O.a)(new Set([].concat(Object(O.a)(e.collection),Object(O.a)(t.collection)))),g=[].concat(Object(O.a)(e.thread),Object(O.a)(t.thread));return u.length>Y||h.length>Y?(Object(S.b)(x.h),void n(!1)):b.length>$||g.length>$?(Object(S.b)(x.k),void n(!1)):void te.notes.get(e.id).then((function(v){return te.notes.get(t.id).then((function(O){var j=v.text+" "+O.text;if(j.length>_)return Object(S.b)(x.j),void n(!1);var k=Object(a.a)({},o),I={id:e.id,text:j,branches:u,roots:h,thread:g,collection:b,pinned:e.pinned||t.pinned,color:"#ffffff"!==e.color?e.color:t.color,colorPreview:"#ffffff"!==e.colorPreview?e.colorPreview:t.colorPreview,version:e.version,leftLink:e.leftLink,rightLink:e.rightLink};Object(f.o)(I),I.branches=I.branches.filter((function(n){return n!==e.id&&n!==t.id})),I.roots=I.roots.filter((function(n){return n!==e.id&&n!==t.id})),I.collection=I.collection.filter((function(n){return n!==e.id&&n!==t.id})),I.thread=I.thread.filter((function(n){return n!==e.id&&n!==t.id})),Object(y.f)(k,I.thread,r),k.notes.set(I.id,I);var w,m=!1,N=0,L=Object(c.a)(k.notes);try{var P=function(){var n=Object(s.a)(w.value,2)[1];n.thread.includes(t.id)&&(n.thread=n.thread.flatMap((function(n){return n===t.id?[e.id]:[n]})),m=!0),n.collection.includes(t.id)&&(n.collection.includes(I.id)||n.collection.push(I.id),n.collection=n.collection.filter((function(e){return e!==t.id})),m=!0),n.branches.includes(t.id)&&(n.branches.includes(I.id)||Object(y.a)(n,I),n.branches=n.branches.filter((function(e){return e!==t.id})),m=!0),n.roots.includes(t.id)&&(n.roots.includes(I.id)||Object(y.a)(I,n),n.roots=n.roots.filter((function(e){return e===t.id})),m=!0),m&&setTimeout((function(){Object(p.a)(n,"meta",r)}),200*(N+=1)),m=!1};for(L.s();!(w=L.n()).done;)P()}catch(T){L.e(T)}finally{L.f()}!i&&o.workspaceIds.includes(e.id)?k.workspaceIds=k.workspaceIds.filter((function(e){return e!==t.id})):k.workspaceIds=k.workspaceIds.flatMap((function(n){return n===t.id?[e.id]:[n]})),k.openedCollectionId===t.id&&(k.openedCollectionId=I.id),k.openedWorkspaceId!==t.id&&k.openedWorkspaceId!==e.id||(k.openedWorkspaceId=I.id,k.workspaceIds=k.workspaceIds.filter((function(n){return n!==t.id&&n!==e.id}))),k.prevSelectedNoteId=k.selectedNoteId,k.selectedNoteId=I.id,Object(p.a)(I,"both",r),l(t.id,!1,k),d(k)}))}))}var U=n(27),W=n(141),R=Object.create(null);R.enabled=!0,R.resetTimer=0,R.waitTimer=250,R.timer=R.resetTimer;var B=function(e){var t=e.dashboard,n=e.selectNote,o=e.deleteNote,r=e.addNote,i=e.packDashboard,c=e.setDelayedNoteUpdate,s=e.setTriggerRerender,d=e.threadOrCollection,l=e.setThreadOrCollection,u=e.setNotesUpdating,f=e.currentPage,h=e.openEditor,p=e.closeAndSave,b=e.moveToTheExtremity,g=e.mergeMode,v=e.openOccurrences,O=function(e,o){if(e.preventDefault?e.preventDefault():e.returnValue=!1,R.enabled){R.enabled=!1,R.timer=R.resetTimer;var r=t.search.findIndex((function(e){return e.id===t.selectedNoteId}));if(-1!==r&&r>=ne.currentSearchSlice*X&&r<=(ne.currentSearchSlice+1)*X+X-1)if("left"===o)if(0!==r){var i=t.search[r-1];s((function(e){return!e})),n(i),ne.usingScrollKeys=!0,r===ne.currentSearchSlice*X&&(ne.setSearchSlice=-1)}else document.getElementById("search-area").scrollLeft=0;else if("right"===o)if(r!==t.search.length-1){var c=t.search[r+1];s((function(e){return!e})),n(c),ne.usingScrollKeys=!0,r===(ne.currentSearchSlice+1)*X+X-1&&(ne.setSearchSlice=1)}else document.getElementById("search-area").scrollLeft=1e6;setTimeout((function(){R.enabled=!0}),R.timer)}},j=function(e){var n=t.notes.get(t.selectedNoteId),o=t.search.find((function(e){return e.id===t.selectedNoteId})),r=t.workspace.find((function(e){return e.id===t.selectedNoteId}));n&&(n.color=U.b[e-1],n.colorPreview=U.c[e-1],c({note:n,delay:1500,metaOrMedia:"meta"})),o&&(o.color=U.b[e-1],o.colorPreview=U.c[e-1]),r&&(r.color=U.b[e-1],r.colorPreview=U.c[e-1]),s((function(e){return!e}))},k=function(e){b(e,!0),i(Object(a.a)({},t),!0)};return W.bind("shift+left",(function(){return"notes"===f&&!g&&k(!1)})),W.bind("shift+right",(function(){return"notes"===f&&!g&&k(!0)})),W.bind("left",(function(e){return"notes"===f&&!g&&O(e,"left")})),W.bind("right",(function(e){return"notes"===f&&!g&&O(e,"right")})),W.bind("p",(function(){return"notes"===f&&function(){var e=t.notes.get(t.selectedNoteId);if(e){var n=Object(a.a)({},t);e.pinned=!e.pinned,i(n,!0),c({note:e,delay:1500,metaOrMedia:"meta"})}}()})),W.bind("enter",(function(){return"notes"===f&&t.selectedNoteId&&!g&&h()})),W.bind("d",(function(){return"notes"===f&&!g&&void(t.selectedNoteId&&window.confirm("Delete the note?")&&o(t.selectedNoteId,!0))})),W.bind("a",(function(){return"notes"===f&&!g&&r()})),W.bind("down",(function(){return"notes"===f&&!g&&function(){var e=t.selectedNoteId;t.notes.get(e)&&T(t,d,e,i)}()})),W.bind("up",(function(){return"notes"===f&&!g&&function(){var e=Object(a.a)({},t),n=e.notes.get(e.selectedNoteId);if(n){var o=e.workspaceIds.findIndex((function(e){return e===n.id}));-1!==o&&C(e,0,i,o)}}()})),W.bind("1",(function(){return"notes"===f&&j(1)})),W.bind("2",(function(){return"notes"===f&&j(2)})),W.bind("3",(function(){return"notes"===f&&j(3)})),W.bind("4",(function(){return"notes"===f&&j(4)})),W.bind("5",(function(){return"notes"===f&&j(5)})),W.bind("6",(function(){return"notes"===f&&j(6)})),W.bind("7",(function(){return"notes"===f&&j(7)})),W.bind("8",(function(){return"notes"===f&&j(8)})),W.bind("space",(function(){return"notes"===f&&!g&&function(){var e=t.notes.get(t.selectedNoteId);if(e){var n=Object(a.a)({},t);M(n,e,d,l,u),i(n)}}()})),W.unbind(["ctrl+s","meta+s"]),W.bind(["ctrl+s","meta+s"],(function(e){return"notes"===f&&!g&&function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,p()}(e)})),W.bind(["ctrl+/","meta+/"],(function(){return"notes"===f&&!g&&(v(),void i(Object(a.a)({},t),!1,!0))})),null},G=n(10),z=l.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(5),n.e(8)]).then(n.bind(null,389))})),H=l.a.lazy((function(){return Promise.all([n.e(0),n.e(7),n.e(10)]).then(n.bind(null,388))})),K=l.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(6),n.e(9)]).then(n.bind(null,387))})),q=function(e){var t=e.dashboard,n=e.selectNote,o=e.deleteNote,r=e.addNote,i=e.packDashboard,c=e.setDelayedNoteUpdate,a=e.triggerRerender,s=e.setTriggerRerender,l=e.threadOrCollection,u=e.setThreadOrCollection,h=e.notesUpdating,p=e.setNotesUpdating,b=e.currentPage,g=e.setCurrentPage,v=e.openEditor,O=e.moveToTheExtremity,j=e.closeAndSave,k=e.mergeMode,I=e.setMergeMode,w=e.darkMode,m=e.setDarkMode,N=e.GAPIloaded,y=e.currentUser,x=e.closeCollection,L=e.rootsOrBranches,P=e.setRootsOrBranches,T=e.searchProps,C=e.setSearchProps,E=e.threadOrCollectionManage,M=e.synchNotes,D=e.updateNote,F=e.exportThread,A=e.openOccurrences,U=e.signInFunction,W=e.signOutFunction,R=e.threadCollectionSwap,q=e.handleOnDragEnd,V=e.showIsolatedNotes,J=e.getStats;return Object(G.jsxs)("div",{children:[Object(G.jsx)(B,{dashboard:t,selectNote:n,deleteNote:o,addNote:r,packDashboard:i,setDelayedNoteUpdate:c,setTriggerRerender:s,threadOrCollection:l,setThreadOrCollection:u,setNotesUpdating:p,currentPage:b,openEditor:v,closeAndSave:j,moveToTheExtremity:O,mergeMode:k,openOccurrences:A}),"notes"===b&&Object(G.jsx)(d.Suspense,{fallback:Object(f.p)(w),children:Object(G.jsx)(K,{darkMode:w,dashboard:t,handleOnDragEnd:q,GAPIloaded:N,currentUser:y,setCurrentPage:g,notesUpdating:h,setDarkMode:m,closeCollection:x,addNote:r,selectNote:n,mergeMode:k,setMergeMode:I,openEditor:v,rootsOrBranches:L,closeAndSave:j,threadOrCollection:l,threadOrCollectionManage:E,setRootsOrBranches:P,searchProps:T,setSearchProps:C,synchNotes:M,triggerRerender:a})}),"editor"===b&&t.selectedNoteId&&Object(G.jsx)(d.Suspense,{fallback:Object(f.p)(w),children:Object(G.jsx)(z,{setCurrentPage:g,dashboard:t,updateNote:D,deleteNote:o,darkMode:w,exportThread:F,threadCollectionSwap:R,moveToTheExtremity:O,openOccurrences:A,packDashboard:i,setDelayedNoteUpdate:c,setNotesUpdating:p})}),Object(G.jsx)("iframe",{title:"printer",id:"ifmcontentstoprint",style:{height:"0px",width:"0px",position:"absolute",border:"0"}}),"settings"===b&&Object(G.jsx)(d.Suspense,{fallback:Object(f.p)(w),children:Object(G.jsx)(H,{darkMode:w,setCurrentPage:g,signInFunction:U,signOutFunction:W,loadedUser:y,GAPIloaded:N,showIsolatedNotes:V,stats:J()})}),Object(G.jsx)(S.a,{})]})},V=(n(330),function(e){var t=e.dashboard,n=e.notesUpdating,o=e.setNotesUpdating,d=e.backup,l=e.packDashboard,u=e.currentPage,b=e.setCurrentPage,g=e.mergeMode,v=e.setMergeMode,j=e.threadOrCollection,k=e.setThreadOrCollection,I=e.rootsOrBranches,w=e.setRootsOrBranches,m=e.triggerRerender,N=e.setTriggerRerender,P=e.darkMode,T=e.setDarkMode,C=e.searchProps,E=e.setSearchProps,M=e.GAPIloaded,F=e.currentUser,U=e.synchNotes,W=e.signInFunction,R=e.signOutFunction,B=e.setDelayedNoteUpdate,z=function(){var e=Object(i.a)(r.a.mark((function e(){var n,o,i,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(a.a)({},t),o=Object(f.i)(),n.notes.getorade.set(o.id,o),n.prevSelectedNoteId=n.selectedNoteId,n.selectedNoteId=o.id,(i=n.notes.get(n.firstNoteId))&&(o.rightLink=n.firstNoteId,i.leftLink=o.id),n.firstNoteId=o.id,n.openedCollectionId&&((c=n.notes.get(n.openedCollectionId)).collection=Object(f.a)(c.collection,0,o.id),d(c,"meta")),te.notes.put(o),d(o,"meta"),i&&d(i,"meta"),l(n),b("editor"),ne.editorModeSelection="prev";case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(){var e=Object(i.a)(r.a.mark((function e(n){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=Object(a.a)({},t)).notes.set(n.id,n),o.selectedNoteId=n.id,d(n,"both"),Object(f.f)(o),l(o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=Object(i.a)(r.a.mark((function e(n,i,c){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c||(c=Object(a.a)({},t)),D(n,i,c,g,v,o,l),g&&v(!1);case 3:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}(),V=function(){var e=Object(i.a)(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:L(t,g,j,k,I,o,l,E,n);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(i.a)(r.a.mark((function e(){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.openedWorkspaceId?Object(S.b)(x.d):j?((n=Object(a.a)({},t)).workspaceIds=Object(O.a)(new Set(Object(O.a)(n.workspaceIds))),l(n),k(!1),ne.toasts&&Object(S.b)("The Collection Mode is on, no links will be stored when you create groups of notes")):(k(!0),ne.toasts&&Object(S.b)("The Thread Mode is on, links between consecutive notes will be stored"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=Object(i.a)(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(y.g)(n,g,v,t,l,$);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=Object(i.a)(r.a.mark((function e(n,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(n,i,v,t,o,j,l,K);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),_=function(){var e=Object(i.a)(r.a.mark((function e(n,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i||(i=Object(a.a)({},t)),Object(y.c)(i,o,j),n||l(i);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(G.jsx)(q,{dashboard:t,selectNote:Y,deleteNote:K,addNote:z,packDashboard:l,setDelayedNoteUpdate:B,triggerRerender:m,setTriggerRerender:N,threadOrCollection:j,setThreadOrCollection:k,notesUpdating:n,setNotesUpdating:o,currentPage:u,setCurrentPage:b,openEditor:function(){te.notes.get(t.selectedNoteId).then((function(e){t.notes.set(t.selectedNoteId,e),b("editor")}))},moveToTheExtremity:function(e,n){var r=null;if(e){var i,a=Object(c.a)(t.notes);try{for(a.s();!(i=a.n()).done;){var d=Object(s.a)(i.value,2)[1];d.rightLink||(r=d)}}catch(u){a.e(u)}finally{a.f()}}else r=t.notes.get(t.firstNoteId);if(r&&r.id!==t.selectedNoteId){var l=t.notes.get(t.selectedNoteId);l&&!l.pinned&&Object(f.k)(t,t.selectedNoteId,r.id,!e,(function(e){return Object(p.a)(e,"meta",o)}),!n)}},closeAndSave:_,mergeMode:g,setMergeMode:v,darkMode:P,setDarkMode:T,GAPIloaded:M,currentUser:F,closeCollection:function(){var e=Object(a.a)({},t);e.openedCollectionId=null,ne.resetSearchScroll=!0,l(e,!0)},rootsOrBranches:I,setRootsOrBranches:w,searchProps:C,setSearchProps:E,threadOrCollectionManage:J,synchNotes:U,updateNote:H,exportThread:function(){Object(h.b)(t)},openOccurrences:function(){_(!0,t),t.workspaceIds=Object(O.a)(t.notes.keys()).filter((function(e){return t.notes.get(e).thread.includes(t.selectedNoteId)||t.notes.get(e).collection.includes(t.selectedNoteId)})),k(!1)},signInFunction:W,signOutFunction:R,threadCollectionSwap:function(e){var n=Object(a.a)({},t),r=n.notes.get(n.selectedNoteId);e?Object(y.j)(r):(Object(y.d)(r),Object(y.f)(n,r.thread,o),n.openedCollectionId===n.selectedNoteId&&(n.openedCollectionId=null)),n.openedWorkspaceId===n.selectedNoteId&&k(!j),l(n),d(r,"meta"),b("notes")},handleOnDragEnd:V,showIsolatedNotes:function(){var e=Object(a.a)({},t);Object(y.c)(e,o,j);var n,r=new Map(t.notes),i=Object(c.a)(t.notes);try{for(i.s();!(n=i.n()).done;){var d,u=Object(s.a)(n.value,2)[1],f=Object(c.a)(u.branches);try{for(f.s();!(d=f.n()).done;){var h=d.value;r.delete(h)}}catch(N){f.e(N)}finally{f.f()}var p,g=Object(c.a)(u.roots);try{for(g.s();!(p=g.n()).done;){var v=p.value;r.delete(v)}}catch(N){g.e(N)}finally{g.f()}var k,I=Object(c.a)(u.collection);try{for(I.s();!(k=I.n()).done;){var w=k.value;r.delete(w)}}catch(N){I.e(N)}finally{I.f()}}}catch(N){i.e(N)}finally{i.f()}var m=Object(O.a)(r.keys());e.workspaceIds=m,l(e,!1,!0),b("notes")},getStats:function(){var e={};e.numberOfNotes=t.notes.size,e.numberOfLinks=0;var n,o=Object(c.a)(t.notes);try{for(o.s();!(n=o.n()).done;){var r=Object(s.a)(n.value,2)[1];e.numberOfLinks+=r.branches.length}}catch(i){o.e(i)}finally{o.f()}return e}})}),J=n(331)();window.katex=N.a;var Y=150,$=300,_=1048576,Q=200,X=12,Z={authorisation:!1,folderId:""},ee={searchText:"",threadFilter:!1,collectionFilter:!1,colorFilter:"#ededed",imgFilter:!1,goClean:!1,areSlicesScrolled:!1},te=new u.a("notes-db");te.version(1).stores({notes:"id, text, preview, branches, roots, thread, collection, pinned, color, colorPreview, attachedImg, version, leftLink, rightLink"});var ne={editorModeSelection:"curr",usingScrollKeys:!1,currentSearchSlice:window.localStorage.getItem("current-slice-search-area"),closingEditor:!1,resetSearchScroll:!1,toasts:!("false"===window.localStorage.getItem("dashboard-toasts")),setSearchSlice:0,ios:"iOS"===J.os.name};t.h=function(e){var t=e.signInFunction,n=e.signOutFunction,o=e.GAPIloaded,l=e.currentUser,u=Object(d.useState)({notes:new Map,firstNoteId:"",workspaceIds:[],selectedNoteId:null,prevSelectedNoteId:null,openedCollectionId:null,openedWorkspaceId:null,search:[],links:[],workspace:[],checkedAgainstDrive:!0}),b=Object(s.a)(u,2),v=b[0],O=b[1],m=Object(d.useState)(Object(a.a)({},ee)),N=Object(s.a)(m,2),y=N[0],x=N[1],S=Object(d.useState)(!1),L=Object(s.a)(S,2),P=L[0],T=L[1],C=Object(d.useState)(!1),E=Object(s.a)(C,2),M=E[0],D=E[1],F=Object(d.useState)(!1),A=Object(s.a)(F,2),U=A[0],W=A[1],R=Object(d.useState)("notes"),B=Object(s.a)(R,2),z=B[0],H=B[1],K=Object(d.useState)(null),q=Object(s.a)(K,2),J=q[0],Y=q[1],$=Object(d.useState)(!1),_=Object(s.a)($,2),Q=_[0],X=_[1],ne=Object(d.useState)(0),oe=Object(s.a)(ne,2),re=oe[0],ie=oe[1],ce=Object(d.useState)(!1),ae=Object(s.a)(ce,2),se=ae[0],de=ae[1],le=Object(d.useState)({note:null,delay:0,metaOrMedia:"",callbackFunction:null,beforeFunction:null}),ue=Object(s.a)(le,2),fe=ue[0],he=ue[1],pe=Object(d.useState)(!0),be=Object(s.a)(pe,2),ge=be[0],ve=be[1];Object(d.useEffect)((function(){var e=Object(a.a)({},v);te.notes.toArray().then((function(t){t.forEach((function(t){e.notes.set(t.id,t),Object(f.e)(t)}));var n,o=Object(c.a)(e.notes);try{for(o.s();!(n=o.n()).done;){var r=Object(s.a)(n.value,2)[1];r.leftLink||(e.firstNoteId=r.id)}}catch(i){o.e(i)}finally{o.f()}ke(e)}));var t=window.localStorage.getItem("dark-mode");t&&X("true"===t)}),[]),Object(d.useEffect)((function(){var e=Object(a.a)({},v);ke(e,!1,!1,!0)}),[P]),Object(d.useEffect)((function(){var e=setTimeout((function(){var e=Object(a.a)({},v);ke(e,!0)}),200);return function(){return clearTimeout(e)}}),[y]),Object(d.useEffect)((function(){if(fe.note){var e=setTimeout((function(){fe.beforeFunction&&fe.beforeFunction(),je(fe.note,fe.metaOrMedia),fe.callbackFunction&&fe.callbackFunction()}),fe.delay);return function(){return clearTimeout(e)}}}),[fe]),Object(d.useEffect)((function(){Z.authorisation=!1,o&&l&&(Z.authorisation=!0,Object(h.a)(Y))}),[o,l]),Object(d.useEffect)((function(){Z.folderId=J,o&&l&&J&&Oe()}),[J,o,l]),Object(d.useEffect)((function(){v.selectedNoteId||"editor"!==z||H("notes")}),[v]),Object(d.useEffect)((function(){if(se){var e=Object(a.a)({},se);Object(f.m)(e,v),ke(e),de(!1)}}),[se,v]);var Oe=function(e){e||(e=Object(a.a)({},v)),e.checkedAgainstDrive&&(console.log("synching"),e.checkedAgainstDrive=!1,function(e,t,n,o){o||(o=0),g(e,{},t,n)}(e,ie,de))},je=function(){var e=Object(i.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(p.a)(t,n,ie);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ke=function(e,t,n,o,r){r||function(e,t){if(!(e.notes.size<2)){var n=null,o=null,r=Object.create(null);r.n=0;var i=e.notes.get(e.firstNoteId),a=null,d=Object.create(null),l=!1;if(!i||i.leftLink){console.log("first note temporarily inexistent or has a left link");var u,f=Object(c.a)(e.notes);try{for(f.s();!(u=f.n()).done;){var h=Object(s.a)(u.value,2)[1];h.leftLink||(e.firstNoteId=h.id,i=h,console.log("better prev note found")),h.rightLink||(n=h,console.log("last note found"))}}catch(x){f.e(x)}finally{f.f()}if(i&&i.leftLink&&(i.leftLink=null,w(i,r,t),console.log("removing wrong left link")),n&&!i){i=n;var p,b=Object(c.a)(e.notes);try{for(b.s();!(p=b.n()).done;){if(Object(s.a)(p.value,1),!(o=e.notes.get(i.leftLink))||d[o.id]){e.firstNoteId=i.id,i.leftLink=null,w(i,r,t),console.log("backwards recevery first note");break}d[(i=o).id]=!0}}catch(x){b.e(x)}finally{b.f()}d=Object.create(null)}if(!i){var g,v=Object(c.a)(e.notes);try{for(v.s();!(g=v.n()).done;){(i=Object(s.a)(g.value,2)[1]).leftLink=null,e.firstNoteId=i.id,w(i,r,t),console.log("last note not found, random picking a first note");break}}catch(x){v.e(x)}finally{v.f()}}}d[i.id]=!0;for(var O=1;O<e.notes.size;O++){if((a=e.notes.get(i.rightLink))&&(d[a.id]?(console.log("loop found: ",O),a=null):a.leftLink!==i.id&&(console.log("left link wrong, fixing: ",O),a.leftLink=i.id,l=!0)),!a){console.log("the successor does not exist: ",O);var j,k=Object(c.a)(e.notes);try{for(k.s();!(j=k.n()).done;){var I=Object(s.a)(j.value,2)[1];if(I.leftLink===i.id&&!d[I.id]){console.log("found match: ",O),a=I,i.rightLink=a.id,w(i,r,t);break}}}catch(x){k.e(x)}finally{k.f()}if(!a){var m,N=Object(c.a)(e.notes);try{for(N.s();!(m=N.n()).done;){var y=Object(s.a)(m.value,2)[1];if(!d[y.id]&&(a&&a.rightLink||(a=y),!e.notes.get(y.leftLink))){console.log("slightly better hard choice found"),a=y;break}}}catch(x){N.e(x)}finally{N.f()}console.log("hard choice made: ",O),i.rightLink=a.id,a.leftLink=i.id,w(i,r,t),l=!0}}d[a.id]=!0,i=a,l&&(w(i,r,t),l=!1)}a.rightLink&&(console.log("last note had a right link"),a.rightLink=null,w(a,r,t))}}(e,je);var i=!t&&!n&&!o;(i||t)&&function(e,t){var n=Object.create(null);n.notes=[];var o={rightLink:e.firstNoteId};if(e.openedCollectionId){var r=e.notes.get(e.openedCollectionId);if(r){var i,a=Object(c.a)(r.collection);try{for(a.s();!(i=a.n()).done;){var s=i.value;o=e.notes.get(s),j(o,t,n)}}catch(l){a.e(l)}finally{a.f()}}else console.log("collection note does not exist")}else for(var d=0;d<e.notes.size;d++)o&&(o=e.notes.get(o.rightLink),j(o,t,n));e.search=n.notes}(e,y),(i||n)&&function(e){var t=[],n=e.workspaceIds.flatMap((function(n,o){return I(e,n,o,t,"noteOfWorkspaceNotFoundError!")}));e.workspace=n,t.length&&(e.workspaceIds=k(t,e.workspaceIds))}(e),(i||o)&&function(e,t,n){if(e.selectedNoteId){var o=e.notes.get(e.selectedNoteId),r=[];t?(e.links=o.roots.flatMap((function(t,n){return I(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.roots=k(r,o.roots),Object(p.a)(o,"meta",n))):(e.links=o.branches.flatMap((function(t,n){return I(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.branches=k(r,o.branches),Object(p.a)(o,"meta",n)))}else e.links=[]}(e,P,ie),O(e)};return Object(G.jsx)(V,{dashboard:v,notesUpdating:re,setNotesUpdating:ie,backup:je,packDashboard:ke,currentPage:z,setCurrentPage:H,mergeMode:U,setMergeMode:W,threadOrCollection:M,setThreadOrCollection:D,rootsOrBranches:P,setRootsOrBranches:T,triggerRerender:ge,setTriggerRerender:ve,darkMode:Q,setDarkMode:X,searchProps:y,setSearchProps:x,GAPIloaded:o,currentUser:l,synchNotes:Oe,signInFunction:t,signOutFunction:n,setDelayedNoteUpdate:he})}},146:function(e,t,n){},17:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"i",(function(){return c})),n.d(t,"e",(function(){return a})),n.d(t,"l",(function(){return s})),n.d(t,"f",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"m",(function(){return u})),n.d(t,"h",(function(){return f})),n.d(t,"k",(function(){return h})),n.d(t,"j",(function(){return p})),n.d(t,"g",(function(){return b}));var o="Cannot insert a note inside its own Thread or Collection",r="Please close your workspace before swapping between Thread Mode and Collection Mode",i="Character limit reached. Additional content will not be saved. Please start a new note instead",c="Merge Mode is on, please select another card to merge to the pink card. The content, links and references of the card you select will be copied. If you want to exit it, press the button again",a="Google Drive is not connected. Please Login from the Settings page to allow the backup",s="------------------------------------------------------------ new note ---------------------------------------------------",d="--------------------------------------------------------- exported thread -------------------------------------------\n",l="Merge Mode is on. Please finish merging or exit the Merge Mode before doing anything else",u="Workspace length limit reached. Please save and start a new Workspace instead",f="The number of links of the resulting note would exceed the limit. Please remove some links to continue",h="The size of the Thread or Collection of the resulting note would exceed the limit. Please remove some notes manually to continue",p="The size of the resulting text exceeds the limit. Please shorten some text to continue",b="Both the cards contain a Thread or a Collection and this generates a conflict in the mergin process. Please empty the Thread or Collection of one of the two notes and try again"},18:function(e,t,n){"use strict";n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return d}));var o=n(13),r=n(17),i=n(6);function c(e,t,n,o){o||(n((function(e){return e+1})),o=0),Object(i.d)(e).then((function(r){if(r.result.files.length){var a=r.result.files[0].id,s=null;"media"===t||"both"===t?s=i.f:"meta"===t&&(s=i.g),s(e,a).then((function(){"both"===t?(n((function(e){return e-1})),c(e,"meta",n)):(console.log("updated"),n((function(e){return e-1})))})).catch((function(r){return Object(i.c)(r,o,c,e,t,n)}))}else Object(i.b)(e).then((function(){"meta"!==t?(c(e,"media",n),n((function(e){return e-1}))):n((function(e){return e-1}))})).catch((function(r){return Object(i.c)(r,o,c,e,t,n)}))})).catch((function(r){return Object(i.c)(r,o,c,e,t,n)}))}function a(e){o.g.notes.bulkGet(e.notes.get(e.selectedNoteId).thread).then((function(e){var t=e.map((function(e){return e.text})),n=r.f+t.reduce((function(e,t){return e+r.l+t})),o=document.getElementById("ifmcontentstoprint").contentWindow;o.document.open(),o.document.write(n),o.document.close(),o.focus(),o.print()}))}function s(e,t){console.log("checkingfolder"),t||(t=0),window.gapi.client.drive.files.list({q:"name='thinkythreads-data' and mimeType='application/vnd.google-apps.folder' and trashed=false"}).then((function(n){if(n.result.files.length)n.result.files[0].id!==o.i.folderId&&e(n.result.files[0].id);else{window.gapi.client.drive.files.create({resource:{name:"thinkythreads-data",mimeType:"application/vnd.google-apps.folder"},fields:"id"}).then((function(t){e(t.result.id)})).catch((function(n){return Object(i.c)(n,t,s,e)}))}})).catch((function(n){return Object(i.c)(n,t,s,e)}))}function d(e,t,n){n||(n=0),t((function(e){return e+1})),window.gapi.client.drive.files.delete({fileId:e}).then((function(){t((function(e){return e-1}))})).catch((function(o){return Object(i.c)(o,n,d,e,t)}))}},191:function(e,t){},27:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return d}));var o=n(4),r=n(135),i=n(80),c=n(83),a=n(10),s=["#b80000","#db3e00","#fccb00","#008b02","#006b76","#1273de","#5300eb","#ededed"],d=["#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#d4c4fb","#ffffff"];t.a=function(e){var t=e.selectedNote,n=e.setBackColor,l=e.setHasChanged,u=e.searchProps,f=e.setSearchProps;e.searchCleanerCheck;return Object(a.jsx)(c.a,{trigger:Object(a.jsx)("div",{className:"tools-btn",style:{color:u?u.colorFilter:void 0,fontSize:"19px"},children:u?"\u2b24":Object(a.jsx)(i.c,{size:"1.4em"})}),nested:!0,modal:!0,children:Object(a.jsx)("div",{className:"picker",children:Object(a.jsx)(r.a,{onChange:function(e){return function(e,t,n,r,i){if(i)i((function(t){var n=Object(o.a)({},t);return n.colorFilter=e.hex,n}));else{switch(r(!0),t.colorPreview=e.hex,e.hex){case s[0]:t.color=d[0];break;case s[1]:t.color=d[1];break;case s[2]:t.color=d[2];break;case s[3]:t.color=d[3];break;case s[4]:t.color=d[4];break;case s[5]:t.color=d[5];break;case s[6]:t.color=d[6];break;case s[7]:t.color=d[7]}n({color:t.color,colorPreview:t.colorPreview})}}(e,t,n,l,f)},colors:["#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#5300EB","#EDEDED"],triangle:"hide"})})})}},336:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n(30),i=n.n(r),c=(n(146),n(9)),a=n.n(c),s=n(16),d=n(126),l=n(127),u=n(137),f=n(136),h=n(13),p=n(10);n(333).config();var b="https://www.googleapis.com/auth/drive.file",g="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",v=function(e){Object(u.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={googleAuth:"",currentUser:localStorage.getItem("currentUser"),loaded:!1,driveFolderId:"",onlineState:window.navigator.onLine},e.initScript=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.querySelector("meta[name=viewport]")).setAttribute("content",n.content+", height="+window.innerHeight+", user-scalable=no"),window.addEventListener("online",(function(){return e.setState({onlineState:!0})})),window.addEventListener("offline",(function(){return e.setState({onlineState:!1})})),e.state.onlineState&&e.loadGAPI();case 5:case"end":return t.stop()}}),t)}))),e.loadGAPI=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.createElement("script")).onload=e.handleClientLoad,n.src="https://apis.google.com/js/api.js",document.body.appendChild(n),console.log("loadingGAPI");case 5:case"end":return t.stop()}}),t)}))),e.initClient=Object(s.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{window.gapi.client.init({apiKey:"AIzaSyDmfaKWGbmsMVLYu1nu83egzWI30vgyD-0",clientId:"455375017729-n44ea0ohjt7hb6jpi5ks56ej89cppv93.apps.googleusercontent.com",scope:b,discoveryDocs:[g]}).then((function(){e.setState({googleAuth:window.gapi.auth2.getAuthInstance(),loaded:!0}),e.state.googleAuth.isSignedIn.listen(e.updateSigninStatus),e.state.googleAuth.then(e.setSigninStatus())}))}catch(n){console.log(n)}case 1:case"end":return t.stop()}}),t)}))),e.signInFunction=function(){e.state.googleAuth.signIn()},e.signOutFunction=function(){e.state.googleAuth.signOut()},e.updateSigninStatus=function(){e.setSigninStatus()},e.setSigninStatus=function(){var t=e.state.googleAuth.currentUser.get();t.isSignedIn()?t.hasGrantedScopes(b)&&localStorage.setItem("currentUser",t.getBasicProfile().getName()):localStorage.setItem("currentUser",null);e.setState({currentUser:localStorage.getItem("currentUser")})},e.handleClientLoad=function(){window.gapi.load("client:auth2",e.initClient)},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.initScript()}},{key:"componentDidUpdate",value:function(){this.state.onlineState&&!this.state.loaded&&this.loadGAPI()}},{key:"render",value:function(){console.log(localStorage.getItem("currentUser"));var e=null!==this.state.currentUser&&"null"!==this.state.currentUser;return Object(p.jsx)(h.h,{signInFunction:this.signInFunction,signOutFunction:this.signOutFunction,GAPIloaded:this.state.loaded&&this.state.onlineState,currentUser:e})}}]),n}(o.Component),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function j(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var k=function(e){e&&e instanceof Function&&n.e(11).then(n.bind(null,386)).then((function(t){var n=t.getCLS,o=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),o(e),r(e),i(e),c(e)}))};i.a.render(Object(p.jsx)(v,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/thinkythreads",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/thinkythreads","/service-worker.js");O?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):j(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):j(t,e)}))}}(),k()},5:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"l",(function(){return f})),n.d(t,"j",(function(){return h})),n.d(t,"k",(function(){return p})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return g})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return O})),n.d(t,"e",(function(){return j})),n.d(t,"i",(function(){return k})),n.d(t,"o",(function(){return I})),n.d(t,"p",(function(){return w})),n.d(t,"b",(function(){return m})),n.d(t,"n",(function(){return N})),n.d(t,"f",(function(){return y})),n.d(t,"m",(function(){return x}));var o=n(7),r=n(8),i=n(79),c=n(13),a=n(84),s=n.n(a),d=(n(1),n(10)),l=n(169);function u(e,t,n){return[].concat(Object(r.a)(e.slice(0,t)),[n],Object(r.a)(e.slice(t)))}function f(e,t){return[].concat(Object(r.a)(e.slice(0,t)),Object(r.a)(e.slice(t+1)))}function h(e,t,n){var o=f(e,t),i=e[t];return o=[].concat(Object(r.a)(o.slice(0,n)),[i],Object(r.a)(o.slice(n)))}function p(e,t,n,o,r,i){var c=e.notes.get(t),a=e.notes.get(n);b(e,c,r),function(e,t,n,o,r,i){var c=e.notes.get(n.leftLink),a=e.notes.get(n.rightLink);o?(t.rightLink=n.id,n.leftLink=t.id,c?(t.leftLink=c.id,c.rightLink=t.id,r(c)):(t.leftLink=null,e.firstNoteId=t.id)):(t.leftLink=n.id,n.rightLink=t.id,a?(t.rightLink=a.id,a.leftLink=t.id,r(a)):t.rightLink=null);i||r(t);r(n)}(e,c,a,o,r,i)}function b(e,t,n){var o=e.notes.get(t.leftLink),r=e.notes.get(t.rightLink);o&&(o.rightLink=t.rightLink,n(o)),r&&(r.leftLink=t.leftLink,n(r),t.id===e.firstNoteId&&(e.firstNoteId=r.id))}function g(e){if(e){var t=e.preview.replace("<br/>","<br>").replace("<p></p><p><br></p>","").replace("<p><strong></strong></p><p><br>","");return n=t.split("<br>")[0].replace(/<[^>]*>?/gm,""),o=100,n.substr(0,o-1)+(n.length>o?"...":"")}return"";var n,o}function v(e,t){return Object(r.a)(e.notes.keys()).reduce((function(n,o){return n&&!e.notes.get(o).thread.includes(t)&&!e.notes.get(o).branches.includes(t)}),!0)}function O(e){return{ui_id:Object(i.a)(),id:e.id,text:e.text,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg,leftLink:e.leftLink,rightLink:e.rightLink}}function j(e){if(e.attachedImg&&e.attachedImg.length){var t=Object(o.a)(e.attachedImg,3),n=t[0],r=t[1];t[2]&&e.text.length>r-n&&(e.text=e.text.substring(n,r).split('"')[0])}else delete e.text}function k(){return{id:Object(i.a)(),text:"",preview:"",branches:[],roots:[],thread:[],collection:[],pinned:!1,color:"#ffffff",colorPreview:"#ffffff",attachedImg:!1,version:0,leftLink:null,rightLink:null}}function I(e){var t=/<img src=.*?>/gm.exec(e.text);if(t){var n=""===e.text.substring(0,t.index).replace(/(<([^>]+)>)|(\s|(&nbsp))*/gm,"");e.attachedImg=[t.index+10,t.index+t[0].length,n]}else e.attachedImg=!1;var o=l.default(e.text.replace(/<p><br\/><\/p>|<p>(\s|(&nbsp))*<\/p>|<img .*?>/gm,""),c.b,{ellipsis:"..."});""===o.replace(/(<([^>]+)>)/gi,"")&&(o=e.attachedImg?"image only note":"empty note kept for its links"),e.preview=o}var w=function(e){return Object(d.jsx)("div",{style:{justifyContent:"center",display:"flex",backgroundColor:e?"#171717":"white",height:"100vh"},children:Object(d.jsx)(s.a,{type:"ThreeDots",color:"#c6c6c6",height:50,width:50,style:{marginTop:"25%"}})})};function m(e,t){var n=!1;if(e.length!==t.length)n=!0;else for(var o=0;o<e.length;o++)e[o]!==t[o]&&(n=!0);return n}function N(e,t){var n=e.notes.get(t);if(e.openedWorkspaceId===t&&(e.openedWorkspaceId=null),e.openedCollectionId===t&&(e.openedCollectionId=null),e.selectedNoteId===t&&(e.selectedNoteId=null),e.prevSelectedNoteId===t&&(e.prevSelectedNoteId=null),e.firstNoteId===t&&n&&n.rightLink){var o=e.notes.get(n.rightLink);o&&(e.firstNoteId=o.id,o.leftLink=null,o.version+=1,delete o.text,c.g.notes.update(o.id,o))}if(n&&!n.rightLink){var r=e.notes.get(n.leftLink);r&&(r.rightLink=null,r.version+=1,delete r.text,c.g.notes.update(r.id,r))}e.workspaceIds=e.workspaceIds.filter((function(e){return e!==t}))}function y(e){if("prev"===c.c.editorModeSelection){var t=e.notes.get(e.prevSelectedNoteId);t&&(e.selectedNoteId=t.id),c.c.editorModeSelection="curr"}}function x(e,t){e.notes.get(t.selectedNoteId)&&(e.selectedNoteId=t.selectedNoteId),e.notes.get(t.prevSelectedNoteId)&&(e.prevSelectedNoteId=t.prevSelectedNoteId),e.notes.get(t.openedCollectionId)&&(e.openedCollectionId=t.openedCollectionId),e.notes.get(t.openedWorkspaceId)&&(e.openedWorkspaceId=t.openedWorkspaceId),e.workspaceIds=t.workspaceIds.flatMap((function(t){return e.notes.get(t)?[t]:[]}))}},6:function(e,t,n){"use strict";n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return d})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return f})),n.d(t,"c",(function(){return h})),n.d(t,"a",(function(){return p})),n.d(t,"h",(function(){return b}));var o=n(4),r=n(13),i=n(5),c=n(18);function a(e,t){return window.gapi.client.request({path:"upload/drive/v3/files/"+t,method:"PATCH",params:{uploadType:"media"},body:e.text})}function s(e){return{description:JSON.stringify({id:e.id,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg,leftLink:e.leftLink,rightLink:e.rightLink}),appProperties:{version:e.version,deleted:e.deleted}}}function d(e,t){return window.gapi.client.request({path:"drive/v3/files/"+t,method:"PATCH",body:s(e)})}function l(e,t){return t||(t=s(e)),t.mimeType="application/json",t.name=e.id,t.fields="id",t.parents=[r.i.folderId],window.gapi.client.drive.files.create({resource:t})}function u(e){return window.gapi.client.drive.files.list({q:"name='"+e.id+"' and mimeType='application/json' and trashed=false and '"+r.i.folderId+"' in parents"})}function f(e){return window.gapi.client.drive.files.get({mimeType:"application/json",fileId:e,alt:"media"})}function h(e,t,n){for(var o=arguments.length,r=new Array(o>3?o-3:0),i=3;i<o;i++)r[i-3]=arguments[i];if(console.error(e),(t+=1)<5)setTimeout((function(){n.apply(void 0,r.concat([t]))}),1e3);else if(n===c.d||n===c.c){var a=r[2];a((function(e){return e-1}))}}function p(e,t,n){e.version=parseInt(e.version)+1;var a=Object(o.a)({},e);Object(i.e)(e),r.i.authorisation&&Object(c.d)(a,t,n),"meta"===t?(delete a.text,r.g.notes.update(a.id,a)):r.g.notes.put(a)}function b(e,t,n){r.g.notes.get(e).then((function(e){return setTimeout((function(){Object(c.d)(e,"both",n)}),200*t)}))}}},[[336,3,4]]]);
//# sourceMappingURL=main.b5eceaa9.chunk.js.map