(this.webpackJsonpthinkythreads=this.webpackJsonpthinkythreads||[]).push([[8],{389:function(e,t,n){"use strict";n.r(t);var o=n(7),c=n(1),r=n(352),a=n.n(r),s=(n(369),n(4)),l=n(349),i=n(80),d=n(340),u=n(27),b=n(348),h=n(83),j=n(10),f=function(e){var t=e.selectedNote,n=e.open,o=e.setOpen,c=e.saveAndExit,r=e.exportThread,a=e.threadCollectionSwap,s=e.openOccurrences,l=e.moveToTheExtremity;return Object(j.jsx)(h.a,{trigger:Object(j.jsx)("div",{children:Object(j.jsx)(b.a,{className:"tools-btn",size:"1.5em",onClick:function(){return o(!0)}})}),nested:!0,modal:!0,open:n,children:Object(j.jsxs)("div",{className:"menu-popup",children:[Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){s(),c()},children:"Show Threads or Collections that contain this Note"}),Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){l(!0),c(!0)},children:"Save and move to the end of the Search"}),Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){l(),c(!0)},children:"Save and move to the beginning of the Search"}),t.thread.length?Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){return r()},children:"Print or Export whole Thread"}),Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){return a(!0)},children:"Convert Thread to Collection"})]}):t.collection.length?Object(j.jsx)("div",{children:Object(j.jsx)("button",{className:"popup-btn tools-btn",onClick:function(){return a(!1)},children:"Convert Collection to Thread"})}):null]})})},p=n(5),O=n(13),m=n(8),g=n(11),v=n(385),x=n(12),k=n(6),C=function(e,t){var n=e.findIndex((function(e){return e===t.selectedNoteId})),o=e;return-1!==n&&(o=Object(p.l)(e,n)),o},N=function(e,t,n,c,r){var a,s,l,i=(a=n,[(s=t).flatMap((function(e){return a.includes(e)?[]:e})),a.flatMap((function(e){return s.includes(e)?[]:e}))]),d=Object(o.a)(i,2),u=d[0],b=d[1],h=Object(g.a)(u);try{for(h.s();!(l=h.n()).done;){var j=l.value,f=e.notes.get(j.value);r?(f.thread.push(e.selectedNoteId),Object(x.f)(e,f.thread,c)):f.collection.push(e.selectedNoteId),Object(k.a)(f,"meta",c),f.id===e.openedWorkspaceId&&(e.workspaceIds=r?Object(m.a)(f.thread):Object(m.a)(f.collection))}}catch(y){h.e(y)}finally{h.f()}var p,O=Object(g.a)(b);try{for(O.s();!(p=O.n()).done;){var v=p.value,N=e.notes.get(v.value);r?(N.thread=C(N.thread,e),Object(x.f)(e,N.thread,c)):N.collection=C(N.collection,e),Object(k.a)(N,"meta",c),N.id===e.openedWorkspaceId&&(e.workspaceIds=r?Object(m.a)(N.thread):Object(m.a)(N.collection))}}catch(y){O.e(y)}finally{O.f()}return!0},y=function(e){var t=e.selectedNote,n=e.open,r=e.setOpen,a=e.dashboard,s=e.setNotesUpdating,l=Object(m.a)(a.notes.values()).flatMap((function(e){return e.thread.length&&e.id!==t.id?{label:Object(p.h)(e),value:e.id}:[]})),d=Object(m.a)(a.notes.values()).flatMap((function(e){return e.collection.length&&e.id!==t.id?{label:Object(p.h)(e),value:e.id}:[]})),u=Object(c.useState)(l.flatMap((function(e){return a.notes.get(e.value).thread.includes(t.id)?e:[]}))),b=Object(o.a)(u,2),f=b[0],O=b[1],g=Object(c.useState)(d.flatMap((function(e){return a.notes.get(e.value).collection.includes(t.id)?e:[]}))),x=Object(o.a)(g,2),k=x[0],C=x[1];return Object(j.jsx)(h.a,{trigger:Object(j.jsx)("div",{children:Object(j.jsx)(i.d,{className:"tools-btn",size:"1.5em",onClick:function(){return r(!0)}})}),nested:!0,modal:!0,open:n,children:Object(j.jsxs)("div",{className:"sorter",children:[Object(j.jsx)(v.a,{className:"sorter-btn sb1",options:l,value:f,onChange:function(e){return N(a,e,f,s,!0)&&O(e)},valueRenderer:function(){return"Threads containing this note"},hasSelectAll:!1,ClearSelectedIcon:" "}),Object(j.jsx)(v.a,{className:"sorter-btn sb2",options:d,value:k,onChange:function(e){return N(a,e,k,s)&&C(e)},valueRenderer:function(){return"Collections containing this note"},hasSelectAll:!1,ClearSelectedIcon:" "}),Object(j.jsx)("div",{onClick:function(){return r(!1)},style:{height:"150px"}})]})})},S=n(141),w=function(e){var t=e.setCurrentPage,n=e.selectedNote,r=e.updateNote,a=e.editorState,b=e.deleteNote,h=e.darkMode,m=e.exportThread,g=e.setBackColor,v=e.threadCollectionSwap,x=e.moveToTheExtremity,k=e.dashboard,C=e.openOccurrences,N=e.packDashboard,w=e.editorRef,T=e.setNotesUpdating;Object(c.useEffect)((function(){if(w&&w.current&&w.current.editor){var e=w.current.editor.keyboard.bindings[83];e&&e.pop(),w.current.editor.keyboard.addBinding({key:"s",shortKey:!0,handler:function(){return a.replace(/<[^>]*>?/gm,"")&&L()}})}}),[w,a]);var E="";n&&(E=n.pinned);var I=Object(c.useState)(E),z=Object(o.a)(I,2),M=z[0],R=z[1],D=Object(c.useState)(!1),P=Object(o.a)(D,2),B=P[0],U=P[1],A=Object(c.useState)(!1),q=Object(o.a)(A,2),W=q[0],Q=q[1],V=Object(c.useState)(!1),F=Object(o.a)(V,2),H=F[0],J=F[1],K=function(){J(!0),n.pinned=!n.pinned,R(n.pinned)},L=function(e){if(O.c.closingEditor=!0,n.text===a&&!H&&""!==a&&!e)return t("notes"),Object(p.e)(n),Object(p.f)(k),void N(Object(s.a)({},k));n.text=a,Object(p.o)(n),"empty note kept for its links"!==n.preview||n.thread.length||n.collection.length||n.branches.length||n.attachedImg?(r(n),t("notes")):(b(n.id),t("notes"))};return S.bind(["ctrl+s","meta+s"],(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,a.replace(/<img .*?>/gm,"0").replace(/<[^>]*>?/gm,"")&&L()})),Object(j.jsx)("div",{children:Object(j.jsxs)("div",{className:"page-footer",style:{color:h?"#636363":"#171717"},children:[Object(j.jsx)(d.a,{className:"tools-btn",onClick:function(){return L()},size:"2.5em"}),M?Object(j.jsx)(l.a,{className:"tools-btn",onClick:function(){return K()},size:"1.75em",style:{transform:"rotate(-45deg)"}}):Object(j.jsx)(l.e,{className:"tools-btn",onClick:function(){return K()},size:"1.75em"}),Object(j.jsx)(u.a,{selectedNote:n,setBackColor:g,setHasChanged:J}),Object(j.jsx)(y,{selectedNote:n,open:W,setOpen:Q,dashboard:k,setNotesUpdating:T}),Object(j.jsx)(i.g,{className:"tools-btn",onClick:function(){window.confirm("Delete the note?")&&(b(n.id),t("notes"))},size:"1.65em"}),Object(j.jsx)(f,{selectedNote:n,open:B,setOpen:U,saveAndExit:L,exportThread:m,threadCollectionSwap:v,openOccurrences:C,moveToTheExtremity:x})]})})},T=n(370),E=n.n(T),I=n(371),z=n.n(I),M=n(17),R=n(15);r.Quill.register("modules/imageCompressor",E.a),r.Quill.register("modules/imageResize",z.a);var D={toolbar:[{header:"1"},{header:"2"},"bold","italic","underline","strike",{list:"ordered"},{list:"bullet"},{align:[]},{color:[]},{background:[]},"image","code-block","formula","blockquote","link"],imageCompressor:{maxWidth:800,maxHeight:800,imageType:"image/jpeg",debug:!1},history:{delay:2e3,maxStack:500,userOnly:!0},clipboard:{matchVisual:!1},imageResize:{parchment:r.Quill.import("parchment"),modules:["Resize","DisplaySize"]}},P=function(e,t,n,o){if(n.current){var c=n.current.editor;!function(e,t){var n=e.ops,o=t.getSelection();if(o){var c=o.index,r=o.length;if(void 0===n[0].retain||!n[1]||!n[1].insert||!n[1].insert||"\n"!==n[1].insert||r>0)return;setTimeout((function(){t.getSelection().index===c&&(console.log("Change selection bad pos"),t.setSelection(t.getSelection().index+1,0))}),30)}}(t,c),e.length<O.e?(o(e),c.getLength()===t.ops[0].retain+2&&document.getElementsByClassName("ql-editor")[0].scrollIntoView({block:"end"})):Object(R.b)(M.c)}};t.default=function(e){var t=e.setCurrentPage,n=e.dashboard,r=e.updateNote,s=e.deleteNote,l=e.darkMode,i=e.exportThread,d=e.threadCollectionSwap,u=e.moveToTheExtremity,b=e.openOccurrences,h=e.packDashboard,f=e.setDelayedNoteUpdate,m=e.setNotesUpdating,g=n.notes.get(n.selectedNoteId),v="",x={color:"",colorPreview:""};g&&g.text&&(v=g.text,x.color=g.color,x.colorPreview=g.colorPreview);var k=Object(c.useState)(v),C=Object(o.a)(k,2),N=C[0],y=C[1],S=Object(c.useState)(x),T=Object(o.a)(S,2),E=T[0],I=T[1],z=Object(c.useState)(!0),M=Object(o.a)(z,2),R=M[0],B=M[1],U=Object(c.useRef)(null),A=function(){var e=Object(c.useRef)(!1);return Object(c.useEffect)((function(){return e.current=!0,function(){return e.current=!1}}),[]),e}();return Object(c.useEffect)((function(){N&&g&&g.text!==N&&(B(!1),f({note:g,delay:2e3,metaOrMedia:"media",callbackFunction:function(){A.current&&B(!0)},beforeFunction:function(){g.text=N,Object(p.o)(g)}}))}),[N]),Object(c.useEffect)((function(){if(U&&!N&&U.current.editor.focus(),O.c.ios){var e=document.getElementsByClassName("ql-editor")[0];e&&(e.style.fontSize="16px")}}),[]),Object(c.useEffect)((function(){var e=document.getElementsByClassName("ql-toolbar")[0];if(e){var t=l?"#ffffff"!==E.color?{backgroundImage:"linear-gradient(20deg, #171717 90%, "+(E.colorPreview||"#171717")+" 90%)",color:"white"}:{backgroundColor:"#171717",color:"white"}:{backgroundColor:E.color||"#ffffff"};e.style.backgroundImage=t.backgroundImage,e.style.color=t.color,e.style.backgroundColor=t.backgroundColor}}),[E]),Object(j.jsxs)("div",{className:"container",style:l?{backgroundColor:"#171717",color:"white"}:{backgroundColor:E.color},children:[Object(j.jsx)("div",{className:"editor no-scrollbar",id:"editor",children:Object(j.jsx)(a.a,{style:{zoom:1.4},theme:"snow",value:N,onChange:function(e,t){P(e,t,U,y)},modules:D,placeholder:"Write your next idea here...",ref:U,scrollingContainer:"#editor"})}),Object(j.jsx)("div",{className:"saved-changes",children:R?"All changes have been saved":"Unsaved changes..."}),Object(j.jsx)(w,{setCurrentPage:t,selectedNote:g,updateNote:r,editorState:N,deleteNote:s,darkMode:l,exportThread:i,setBackColor:I,threadCollectionSwap:d,moveToTheExtremity:u,dashboard:n,openOccurrences:b,packDashboard:h,editorRef:U,setNotesUpdating:m})]})}}}]);
//# sourceMappingURL=8.a915e537.chunk.js.map