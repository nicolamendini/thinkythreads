(this.webpackJsonpthinkythreads=this.webpackJsonpthinkythreads||[]).push([[2],{1:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"k",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"j",(function(){return p})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return b})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return k})),n.d(t,"e",(function(){return w})),n.d(t,"h",(function(){return I})),n.d(t,"l",(function(){return O})),n.d(t,"m",(function(){return j})),n.d(t,"b",(function(){return m}));var o=n(5),r=n(4),i=n(33),c=n(23),a=n(35),s=n.n(a),d=(n(0),n(9)),l=n(87);function u(e,t,n){return[].concat(Object(r.a)(e.slice(0,t)),[n],Object(r.a)(e.slice(t)))}function f(e,t){return[].concat(Object(r.a)(e.slice(0,t)),Object(r.a)(e.slice(t+1)))}function h(e,t,n){var o=f(e,t),i=e[t];return o=[].concat(Object(r.a)(o.slice(0,n)),[i],Object(r.a)(o.slice(n)))}function p(e,t,n,o,r){var i=e.notes.get(t),c=e.notes.get(n);g(e,i,r),function(e,t,n,o,r){var i=e.notes.get(n.leftLink),c=e.notes.get(n.rightLink);o?(t.rightLink=n.id,n.leftLink=t.id,i?(t.leftLink=i.id,i.rightLink=t.id,r(i)):(t.leftLink=null,e.firstNoteId=t.id)):(t.leftLink=n.id,n.rightLink=t.id,c?(t.rightLink=c.id,c.leftLink=t.id,r(c)):t.rightLink=null);r(t),r(n)}(e,i,c,o,r)}function g(e,t,n){var o=e.notes.get(t.leftLink),r=e.notes.get(t.rightLink);o&&(o.rightLink=t.rightLink,n(o)),r&&(r.leftLink=t.leftLink,n(r),t.id===e.firstNoteId&&(e.firstNoteId=r.id))}function b(e){var t,n,o=e.preview.replace("<br/>","<br>");return t=o.split("<br>")[0].replace(/<[^>]*>?/gm,""),n=100,t.substr(0,n-1)+(t.length>n?"...":"")}function v(e,t){return Object(r.a)(e.notes.keys()).reduce((function(n,o){return n&&!e.notes.get(o).thread.includes(t)&&!e.notes.get(o).branches.includes(t)}),!0)}function k(e){return{ui_id:Object(i.a)(),id:e.id,text:e.text,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg,leftLink:e.leftLink,rightLink:e.rightLink}}function w(e){if(e.attachedImg.length){var t=Object(o.a)(e.attachedImg,3),n=t[0],r=t[1];t[2]&&e.text.length>r-n&&(e.text=e.text.substring(n,r).split('"')[0])}else delete e.text}function I(){return{id:Object(i.a)(),text:"",preview:"",branches:[],roots:[],thread:[],collection:[],pinned:!1,color:"#ffffff",colorPreview:"#ffffff",attachedImg:!1,version:0,leftLink:null,rightLink:null}}function O(e){var t=/<img src=.*?>/gm.exec(e.text);if(t){var n=""===e.text.substring(0,t.index).replace(/(<([^>]+)>)|(\s|(&nbsp))*/gm,"");e.attachedImg=[t.index+10,t.index+t[0].length,n]}else e.attachedImg=!1;var o=l.default(e.text.replace(/<p><br\/><\/p>|<p>(\s|(&nbsp))*<\/p>|<img .*?>/gm,""),c.b,{ellipsis:"..."});""===o.replace(/(<([^>]+)>)/gi,"")&&(o=e.attachedImg?"image only note":"empty note kept for its links"),e.preview=o}var j=Object(d.jsx)("div",{style:{justifyContent:"center",display:"flex"},children:Object(d.jsx)(s.a,{type:"ThreeDots",color:"#c6c6c6",height:50,width:50,style:{marginTop:"25%"}})});function m(e,t){var n=!1;if(e.length!==t.length)n=!0;else for(var o=0;o<e.length;o++)e[o]!==t[o]&&(n=!0);return n}},109:function(e,t){},145:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n(34),i=n.n(r),c=(n(64),n(3)),a=n.n(c),s=n(8),d=n(53),l=n(54),u=n(59),f=n(58),h=n(23),p=n(9),g="https://www.googleapis.com/auth/drive.file",b="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",v=function(e){Object(u.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={googleAuth:"",currentUser:localStorage.getItem("currentUser"),loaded:!1,driveFolderId:"",onlineState:window.navigator.onLine},e.initScript=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.querySelector("meta[name=viewport]")).setAttribute("content",n.content+", height="+window.innerHeight+", user-scalable=no"),window.addEventListener("online",(function(){return e.setState({onlineState:!0})})),window.addEventListener("offline",(function(){return e.setState({onlineState:!1})})),e.state.onlineState&&e.loadGAPI();case 5:case"end":return t.stop()}}),t)}))),e.loadGAPI=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.createElement("script")).onload=e.handleClientLoad,n.src="https://apis.google.com/js/api.js",document.body.appendChild(n),console.log("loadingGAPI");case 5:case"end":return t.stop()}}),t)}))),e.initClient=Object(s.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{window.gapi.client.init({apiKey:"AIzaSyDmfaKWGbmsMVLYu1nu83egzWI30vgyD-0",clientId:"455375017729-n44ea0ohjt7hb6jpi5ks56ej89cppv93.apps.googleusercontent.com",scope:g,discoveryDocs:[b]}).then((function(){e.setState({googleAuth:window.gapi.auth2.getAuthInstance(),loaded:!0}),e.state.googleAuth.isSignedIn.listen(e.updateSigninStatus),e.state.googleAuth.then(e.setSigninStatus())}))}catch(n){console.log(n)}case 1:case"end":return t.stop()}}),t)}))),e.signInFunction=function(){e.state.googleAuth.signIn()},e.signOutFunction=function(){e.state.googleAuth.signOut()},e.updateSigninStatus=function(){e.setSigninStatus()},e.setSigninStatus=function(){var t=e.state.googleAuth.currentUser.get();t.isSignedIn()?t.hasGrantedScopes(g)&&localStorage.setItem("currentUser",t.getBasicProfile().getName()):localStorage.setItem("currentUser",null);e.setState({currentUser:localStorage.getItem("currentUser")})},e.handleClientLoad=function(){window.gapi.load("client:auth2",e.initClient)},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.initScript()}},{key:"componentDidUpdate",value:function(){this.state.onlineState&&!this.state.loaded&&this.loadGAPI()}},{key:"render",value:function(){console.log(localStorage.getItem("currentPage")),console.log(localStorage.getItem("currentUser"));var e=null!==this.state.currentUser&&"null"!==this.state.currentUser;return Object(p.jsx)(h.f,{signInFunction:this.signInFunction,signOutFunction:this.signOutFunction,GAPIloaded:this.state.loaded&&this.state.onlineState,currentUser:e})}}]),n}(o.Component),k=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function w(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var I=function(e){e&&e instanceof Function&&n.e(10).then(n.bind(null,371)).then((function(t){var n=t.getCLS,o=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),o(e),r(e),i(e),c(e)}))};i.a.render(Object(p.jsx)(v,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/thinkythreads",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/thinkythreads","/service-worker.js");k?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):w(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):w(t,e)}))}}(),I()},23:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y})),n.d(t,"d",(function(){return $})),n.d(t,"c",(function(){return _})),n.d(t,"b",(function(){return Q})),n.d(t,"g",(function(){return X})),n.d(t,"e",(function(){return Z}));var o=n(4),r=n(3),i=n.n(r),c=n(8),a=n(10),s=n(2),d=n(5),l=n(0),u=n.n(l),f=n(55),h=n(1),p=n(7);function g(e,t){return window.gapi.client.request({path:"upload/drive/v3/files/"+t,method:"PATCH",params:{uploadType:"media"},body:e.text})}function b(e){return{description:JSON.stringify({id:e.id,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg,leftLink:e.leftLink,rightLink:e.rightLink}),appProperties:{version:e.version,deleted:e.deleted}}}function v(e,t){return window.gapi.client.request({path:"drive/v3/files/"+t,method:"PATCH",body:b(e)})}function k(e){return window.gapi.client.drive.files.list({q:"name='"+e.id+"' and mimeType='application/json' and trashed=false and '"+X.folderId+"' in parents"})}function w(e,t,n){for(var o=arguments.length,r=new Array(o>3?o-3:0),i=3;i<o;i++)r[i-3]=arguments[i];if(console.error(e),t+=1,e.result&&-1===e.result.error.code&&t<2||t<4)setTimeout((function(){n.apply(void 0,r.concat([t]))}),1e3);else if(n===j||n===m){var c=r[2];c((function(e){return e-1}))}}function I(e,t,n){e.version=parseInt(e.version)+1;var o=Object(s.a)({},e);Object(h.e)(e),X.authorisation&&(n((function(e){return e+1})),j(o,t,n)),"meta"===t?(delete o.text,Z.notes.update(o.id,o)):Z.notes.put(o)}function O(e,t,n){Z.notes.get(e).then((function(e){return setTimeout((function(){n((function(e){return e+1})),j(e,"both",n)}),200*t)}))}function j(e,t,n,o){o||(o=0),k(e).then((function(r){if(r.result.files.length){var i=r.result.files[0].id,c=null;"media"===t||"both"===t?c=g:"meta"===t&&(c=v),c(e,i).then((function(o){"both"===t?j(e,"meta",n):(console.log("updated"),n((function(e){return e-1})))})).catch((function(r){return w(r,o,j,e,t,n)}))}else(function(e,t){return t||(t=b(e)),t.mimeType="application/json",t.name=e.id,t.fields="id",t.parents=[X.folderId],window.gapi.client.drive.files.create({resource:t})})(e).then((function(o){"meta"!==t?j(e,"media",n):n((function(e){return e-1}))})).catch((function(r){return w(r,o,j,e,t,n)}))})).catch((function(r){return w(r,o,j,e,t,n)}))}function m(e,t,n){n||(n=0),k(e).then((function(o){o.result.files.length?window.gapi.client.drive.files.delete({fileId:o.result.files[0].id}).then((function(){t((function(e){return e-1}))})).catch((function(o){return w(o,n,m,e,t)})):t((function(e){return e-1}))})).catch((function(o){return w(o,n,m,e,t)}))}function y(e){Z.notes.bulkGet(e.notes.get(e.selectedNoteId).thread).then((function(e){var t=e.map((function(e){return e.text})),n=p.g+t.reduce((function(e,t){return e+p.m+t})),o=document.getElementById("ifmcontentstoprint").contentWindow;o.document.open(),o.document.write(n),o.document.close(),o.focus(),o.print()}))}function x(e,t){console.log("checkingfolder"),t||(t=0),window.gapi.client.drive.files.list({q:"name='thinkythreads-data' and mimeType='application/vnd.google-apps.folder' and trashed=false"}).then((function(n){if(n.result.files.length)n.result.files[0].id!==X.folderId&&e(n.result.files[0].id);else{window.gapi.client.drive.files.create({resource:{name:"thinkythreads-data",mimeType:"application/vnd.google-apps.folder"},fields:"id"}).then((function(t){e(t.result.id)})).catch((function(n){return w(n,t,x,e)}))}})).catch((function(n){return w(n,t,x,e)}))}function L(e,t,n,o,r,i,c,a){var s;a||(a=0),(s=n.result.files[o].id,window.gapi.client.drive.files.get({mimeType:"application/json",fileId:s,alt:"media"})).then((function(a){return function(e,t,n,o,r,i,c,a){var s=JSON.parse(n.result.files[r].description);s.text=o.body,s.version=parseInt(n.result.files[r].appProperties.version),e.notes.set(s.id,s),Z.notes.put(s).then(Object(h.e)(s)),a.count+=1,i((function(e){return e-1})),a.count===n.result.files.length&&(n.result.nextPageToken?S(e,t,i,c,n.result.nextPageToken):N(e,t,i,c))}(e,t,n,a,o,r,i,c)})).catch((function(s){return w(s,a,L,e,t,n,o,r,i,c)}))}function S(e,t,n,o,r,i){i||(i=0),window.gapi.client.drive.files.list({fields:"nextPageToken, files(description, id, name, appProperties)",q:"mimeType='application/json' and trashed=false and '"+X.folderId+"' in parents",pageToken:r}).then((function(r){!function(e,t,n,o,r){for(var i={count:0},c=0;c<n.result.files.length;c++){var a=n.result.files[c],s=a.name;if("true"===a.appProperties.deleted)e.notes.get(s)&&(e.notes.delete(s),Z.notes.delete(s)),i.count+=1;else{var d=parseInt(a.appProperties.version);t[s]=d;var l=e.notes.get(s);!l||d>l.version?(L(e,t,n,c,o,r,i),o((function(e){return e+1}))):i.count+=1}}n.result.nextPageToken?S(e,t,o,r,n.result.nextPageToken):i.count===n.result.files.length&&N(e,t,o,r)}(e,t,r,n,o)})).catch((function(c){return w(c,i,S,e,t,n,o,r)}))}function N(e,t,n,o){var r,i=0,c=Object(a.a)(e.notes);try{for(c.s();!(r=c.n()).done;){var s=Object(d.a)(r.value,2),l=s[0],u=s[1],f=t[l];console.log(f,u.version),(!f||f<u.version)&&O(l,i+=1,n),u.leftLink||(e.firstNoteId=u.id)}}catch(h){c.e(h)}finally{c.f()}e.checkedAgainstDrive=!0,o(e)}function P(e,t,n){if(e.selectedNoteId){var o=e.notes.get(e.selectedNoteId),r=[];t?(e.links=o.roots.flatMap((function(t,n){return C(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.roots=T(r,o.roots),I(o,"meta",n))):(e.links=o.branches.flatMap((function(t,n){return C(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.branches=T(r,o.branches),I(o,"meta",n)))}else e.links=[]}function T(e,t){return t.filter((function(t,n){return!e.includes(n)}))}function C(e,t,n,o,r){return e.notes.get(t)?[Object(h.d)(e.notes.get(t))]:(o.push(n),function(e,t,n){window.alert("-------- BETA VERSION ERROR REPORT ------- \n---- PLEASE SHARE WITH THE DEVELOPER --- \nalong with some info about what you did to get here \nEMAIL: nicolamendini0@gmail.com \nTHANK YOU!\n\nERROR: \n"+e+"\n\nNOTE: \n"+t+"\n\n\nNOTES-ORDER: \n"+n.notesOrder+"\n\nLINKS: \n"+n.links+"\n\nWORKSPACE-IDS: \n"+n.workspaceIds)}(r,t,e),[])}function A(e,t,n){e.openedWorkspaceId===t||(e.workspaceIds=Object(h.a)(e.workspaceIds,n,t),e.selectedNoteId=t)}function E(e,t){var n=!e.branches.includes(t.id),o=e.id!==t.id,r=e.branches.length<Y,i=!t.roots.includes(e.id),c=t.roots.length<Y;if(n&&o&&r&&i&&c)return e.branches.push(t.id),t.roots.push(e.id),!0}function W(e,t,n){var o,r=Object(a.a)(e.notes);try{for(r.s();!(o=r.n()).done;)for(var i=Object(d.a)(o.value,2)[1],c=1;c<i.thread.length;c++)if(i.thread[c-1]===t.id&&i.thread[c]===n.id)return alert("The link you are tying to delete is used in the Thread : "+Object(h.g)(i)+"... \nPlease restructure this Thread it if you desire to proceed."),!1}catch(l){r.e(l)}finally{r.f()}var s=t.branches.findIndex((function(e){return e===n.id}));return-1!==s&&(t.branches=Object(h.k)(t.branches,s)),-1!==(s=n.roots.findIndex((function(e){return e===t.id})))&&(n.roots=Object(h.k)(n.roots,s)),!0}function F(e,t,n){for(var o=0,r=function(r){var i=e.notes.get(t[r-1]),c=e.notes.get(t[r]);E(i,c)&&setTimeout((function(){I(i,"meta",n),I(c,"meta",n)}),200*(o+=1))},i=1;i<t.length;i++)r(i)}function M(e,t,n,r){U(!0,t,n,r);var i=t.notes.get(t.selectedNoteId);t.workspaceIds=e?Object(o.a)(i.thread):Object(o.a)(i.collection),t.openedWorkspaceId=t.selectedNoteId}function U(e,t,n,o){if(t.openedWorkspaceId||!t.workspaceIds.length||e||window.confirm("You have an "+(o?"unsaved thread":"unsaved collection")+", do you wish to delete it and clean the Workspace?")){if(t.openedWorkspaceId){var r=t.notes.get(t.openedWorkspaceId),i=!1;o?(i=Object(h.b)(r.thread,t.workspaceIds))&&(r.thread=t.workspaceIds,F(t,r.thread,n)):(i=Object(h.b)(r.collection,t.workspaceIds))&&(r.collection=t.workspaceIds),i&&I(r,"meta",n),t.openedWorkspaceId=null}t.workspaceIds=[]}}function D(e,t,n,o,r,i){if(t)e.id!==o.selectedNoteId?e.thread.length&&o.notes.get(o.selectedNoteId).collection.length||o.notes.get(o.selectedNoteId).thread.length&&e.collection.length?alert(p.h):i(o.notes.get(o.selectedNoteId),e):n(!1);else if(!o.selectedNoteId||o.selectedNoteId!==e.id){o.selectedNoteId=e.id;var c=Object(s.a)({},o);c.selectedNoteId=e.id,r(c,!1,!1,!0)}}function R(e,t,n,o,r,i,c,a){if(null!==a.destination)if(t)alert(p.a);else if("search-area"===a.source.droppableId){if("workspace-area"===a.destination.droppableId){var d=e.search[a.source.index].id;if(e.workspaceIds.length>$)alert(p.n);else if(n){var l=Object(s.a)({},e);A(l,d,a.destination.index),c(l,!1,!0,!0)}else if((!e.openedWorkspaceId||e.openedWorkspaceId!==d)&&!e.workspaceIds.includes(d)){var u=Object(s.a)({},e);u.workspaceIds.push(d),c(u,!1,!0)}}else if("branches-area"===a.destination.droppableId){var f=Object(s.a)({},e),g=f.notes.get(e.search[a.source.index].id),b=f.notes.get(e.selectedNoteId);r?E(g,b)&&(I(b,"meta",i),I(g,"meta",i)):E(b,g)&&(I(b,"meta",i),I(g,"meta",i)),c(f,!1,!1,!0)}else if("wrapper-area"===a.destination.droppableId){var v=Object(s.a)({},e),k=e.search[a.source.index];e.workspaceIds.length>0?function(e,t,n,o){if(!e.notes.get(t).thread.length&&!e.notes.get(t).collection.length)if(e.workspaceIds.includes(t))alert(p.b);else{var r=e.notes.get(t);o?(r.thread=e.workspaceIds,F(e,r.thread,n)):r.collection=e.workspaceIds,e.selectedNoteId=t,M(o,e,n,o),I(r,"meta",n)}}(v,k.id,i,n):k.thread.length?(v.selectedNoteId=k.id,M(!0,v,i,n),o(!0)):k.collection.length&&(v.selectedNoteId=k.id,M(!1,v,i,n),o(!1)),c(v)}else if("search-area"===a.destination.droppableId){if(a.source.index!==a.destination.index){var w=e.search[a.source.index],O=e.search[a.destination.index],j=a.source.index>a.destination.index;if(!(!O.pinned&&w.pinned||!w.pinned&&O.pinned)){var m=Object(s.a)({},e);w.pinned?Object(h.j)(m,O.id,w.id,j,(function(e){return I(e,"meta",i)})):Object(h.j)(m,w.id,O.id,j,(function(e){return I(e,"meta",i)})),m.selectedNoteId=w.id,c(m,!0,!1,!0)}}}else if("search-bar"===a.destination.droppableId){var y=Object(s.a)({},e),x=e.search[a.source.index];y.openedCollectionId=x.id,c(y,!0)}}else if("workspace-area"===a.source.droppableId){if("search-area"===a.destination.droppableId){var L=Object(s.a)({},e);L.workspaceIds=Object(h.k)(L.workspaceIds,a.source.index),a.source.index>0&&n&&(L.selectedNoteId=L.workspaceIds[a.source.index-1],P(L,r,i)),c(L,!1,!0)}else if("workspace-area"===a.destination.droppableId){var S=Object(s.a)({},e);S.workspaceIds=Object(h.i)(S.workspaceIds,a.source.index,a.destination.index),S.selectedNoteId=S.workspaceIds[a.destination.index],c(S,!1,!0,!0)}}else if("branches-area"===a.source.droppableId)if("search-area"===a.destination.droppableId){var N=Object(s.a)({},e),T=N.notes.get(e.links[a.source.index].id),C=N.notes.get(e.selectedNoteId);r?W(N,T,C)&&(I(C,"meta",i),I(T,"meta",i)):W(N,C,T)&&(I(C,"meta",i),I(T,"meta",i)),c(N,!0,!1,!0)}else if("workspace-area"===a.destination.droppableId)if(e.workspaceIds.length>$)alert(p.n);else{var U=Object(s.a)({},e);A(U,e.links[a.source.index].id,a.destination.index),c(U,!1,!0,!0)}else if("branches-area"===a.destination.droppableId){var D=Object(s.a)({},e),R=D.notes.get(D.selectedNoteId);r?R.roots=Object(h.i)(R.roots,a.source.index,a.destination.index):R.branches=Object(h.i)(R.branches,a.source.index,a.destination.index),I(R,"meta",i),c(D,!1,!1,!0)}}function G(e,t,n,o,r,i,c){var s=n.notes.get(e);if(Object(h.c)(n,e)||o){if(Object(h.f)(n,s,(function(e){return I(e,"meta",i)})),n.notes.delete(e),s.deleted=!0,o)r(!1);else{var l,u=0,f=Object(a.a)(n.notes);try{var g=function(){var t=Object(d.a)(l.value,2)[1],n=t.collection.findIndex((function(t){return t===e}));-1!==n&&(t.collection=Object(h.k)(t.collection,n),setTimeout((function(){I(t,"meta",i)}),200*(u+=1)))};for(f.s();!(l=f.n()).done;)g()}catch(b){f.e(b)}finally{f.f()}n.openedWorkspaceId===e&&(n.openedWorkspaceId=null),n.openedCollectionId===e&&(n.openedCollectionId=null),n.selectedNoteId===e&&(n.selectedNoteId=null),n.workspaceIds=n.workspaceIds.filter((function(t){return t!==e}))}X.authorisation&&(i((function(e){return e+1})),j(s,"meta",i)),Z.notes.delete(e),c(n)}else(t||window.confirm(p.e))&&(!function(e,t,n){var o,r=!1,i=0,c=Object(a.a)(e.notes);try{var s=function(){var c=Object(d.a)(o.value,2)[1];c.branches.includes(t)&&(c.branches=c.branches.filter((function(e){return e!==t})),r=!0),c.roots.includes(t)&&(c.roots=c.roots.filter((function(e){return e!==t})),r=!0),c.thread.includes(t)&&(c.thread=c.thread.filter((function(e){return e!==t})),F(e,c.thread,n),r=!0),r&&setTimeout((function(){I(c,"meta",n)}),200*(i+=1)),r=!1};for(c.s();!(o=c.n()).done;)s()}catch(b){c.e(b)}finally{c.f()}}(n,e,i),G(e,!1,n,o,r,i,c))}function z(e,t,n,r,i,c,l,u){var f=Object(o.a)(new Set([].concat(Object(o.a)(e.branches),Object(o.a)(t.branches)))),g=Object(o.a)(new Set([].concat(Object(o.a)(e.roots),Object(o.a)(t.roots)))),b=Object(o.a)(new Set([].concat(Object(o.a)(e.collection),Object(o.a)(t.collection)))),v=[].concat(Object(o.a)(e.thread),Object(o.a)(t.thread));return f.length>Y||g.length>Y?(alert(p.i),void n(!1)):b.length>$||v.length>$?(alert(p.l),void n(!1)):void Z.notes.get(e.id).then((function(o){return Z.notes.get(t.id).then((function(k){var w=o.text+" "+k.text;if(w.length>_)return alert(p.k),void n(!1);var O=Object(s.a)({},r),j={id:e.id,text:w,branches:f,roots:g,thread:v,collection:b,pinned:e.pinned||t.pinned,color:"#ffffff"!==e.color?e.color:t.color,colorPreview:"#ffffff"!==e.colorPreview?e.colorPreview:t.colorPreview,version:e.version,leftLink:e.leftLink,rightLink:e.rightLink};Object(h.l)(j),j.branches=j.branches.filter((function(n){return n!==e.id&&n!==t.id})),j.roots=j.roots.filter((function(n){return n!==e.id&&n!==t.id})),j.collection=j.collection.filter((function(n){return n!==e.id&&n!==t.id})),j.thread=j.thread.filter((function(n){return n!==e.id&&n!==t.id})),F(O,j.thread,i),O.notes.set(j.id,j);var m,y=!1,x=0,L=Object(a.a)(O.notes);try{var S=function(){var n=Object(d.a)(m.value,2)[1];n.thread.includes(t.id)&&(n.thread=n.thread.flatMap((function(n){return n===t.id?[e.id]:[n]})),y=!0),n.collection.includes(t.id)&&(n.collection.includes(j.id)||n.collection.push(j.id),n.collection=n.collection.filter((function(e){return e!==t.id})),y=!0),n.branches.includes(t.id)&&(n.branches.includes(j.id)||E(n,j),n.branches=n.branches.filter((function(e){return e!==t.id})),y=!0),n.roots.includes(t.id)&&(n.roots.includes(j.id)||E(j,n),n.roots=n.roots.filter((function(e){return e===t.id})),y=!0),y&&setTimeout((function(){I(n,"meta",i)}),200*(x+=1)),y=!1};for(L.s();!(m=L.n()).done;)S()}catch(N){L.e(N)}finally{L.f()}!c&&r.workspaceIds.includes(e.id)?O.workspaceIds=O.workspaceIds.filter((function(e){return e!==t.id})):O.workspaceIds=O.workspaceIds.flatMap((function(n){return n===t.id?[e.id]:[n]})),O.openedCollectionId===t.id&&(O.openedCollectionId=j.id),O.openedWorkspaceId!==t.id&&O.openedWorkspaceId!==e.id||(O.openedWorkspaceId=j.id,O.workspaceIds=O.workspaceIds.filter((function(n){return n!==t.id&&n!==e.id}))),O.selectedNoteId=j.id,I(j,"both",i),u(t.id,!1,O),l(O)}))}))}n(144);var B=n(57),q=n.n(B),H=n(9);window.katex=q.a;var K=u.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(5),n.e(8)]).then(n.bind(null,373))})),J=u.a.lazy((function(){return Promise.all([n.e(0),n.e(7)]).then(n.bind(null,374))})),V=u.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(6),n.e(9)]).then(n.bind(null,372))})),Y=150,$=300,_=1048576,Q=200,X={authorisation:!1,folderId:""},Z=new f.a("notes-db");Z.version(1).stores({notes:"id, text, preview, branches, roots, thread, collection, pinned, color, colorPreview, attachedImg, version, leftLink, rightLink"});t.f=function(e){var t=e.signInFunction,n=e.signOutFunction,r=e.GAPIloaded,u=e.currentUser,f=Object(l.useState)({notes:new Map,firstNoteId:"",workspaceIds:[],selectedNoteId:null,openedCollectionId:null,openedWorkspaceId:null,search:[],links:[],workspace:[],checkedAgainstDrive:!0}),g=Object(d.a)(f,2),b=g[0],v=g[1],k=Object(l.useState)({searchText:"",threadFilter:!1,collectionFilter:!1,colorFilter:"#ededed"}),w=Object(d.a)(k,2),O=w[0],j=w[1],m=Object(l.useState)(!1),L=Object(d.a)(m,2),N=L[0],A=L[1],E=Object(l.useState)(!1),W=Object(d.a)(E,2),M=W[0],B=W[1],q=Object(l.useState)(!1),Y=Object(d.a)(q,2),$=Y[0],_=Y[1],Q=Object(l.useState)("notes"),ee=Object(d.a)(Q,2),te=ee[0],ne=ee[1],oe=Object(l.useState)(null),re=Object(d.a)(oe,2),ie=re[0],ce=re[1],ae=Object(l.useState)(!1),se=Object(d.a)(ae,2),de=se[0],le=se[1],ue=Object(l.useState)(0),fe=Object(d.a)(ue,2),he=fe[0],pe=fe[1];Object(l.useEffect)((function(){var e=Object(s.a)({},b);Z.notes.toArray().then((function(t){t.forEach((function(t){e.notes.set(t.id,t),Object(h.e)(t)}));var n,o=Object(a.a)(e.notes);try{for(o.s();!(n=o.n()).done;){var r=Object(d.a)(n.value,2)[1];r.leftLink||(e.firstNoteId=r.id)}}catch(i){o.e(i)}finally{o.f()}ve(e)}));var t=window.localStorage.getItem("dark-mode");t&&le("true"===t)}),[]),Object(l.useEffect)((function(){var e=Object(s.a)({},b);ve(e,!1,!1,!0)}),[N]),Object(l.useEffect)((function(){var e=Object(s.a)({},b);ve(e,!0)}),[O]),Object(l.useEffect)((function(){X.authorisation=!1,r&&u&&(X.authorisation=!0,x(ce))}),[r,u]),Object(l.useEffect)((function(){X.folderId=ie,r&&u&&ie&&ge()}),[ie,r,u]),Object(l.useEffect)((function(){b.selectedNoteId||"editor"!==te||ne("notes")}),[b]);var ge=function(e){e||(e=Object(s.a)({},b)),e.checkedAgainstDrive&&(console.log("synching"),e.checkedAgainstDrive=!1,function(e,t,n,o){o||(o=0),S(e,{},t,n)}(e,pe,ve))},be=function(){var e=Object(c.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I(t,n,pe);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ve=function(e,t,n,r){ke(e)||function(e,t){var n,o={id:null,rightLink:null},r=Object(a.a)(e.notes);try{for(r.s();!(n=r.n()).done;){var i=Object(d.a)(n.value,2)[1];i.leftLink=o.id,o.rightLink=i.id,o=i}}catch(l){r.e(l)}finally{r.f()}o.rightLink=null,e.firstNoteId=o.id;var c,s=Object(a.a)(e.notes);try{for(s.s();!(c=s.n()).done;)t(Object(d.a)(c.value,2)[1],"meta")}catch(l){s.e(l)}finally{s.f()}}(e,be);var i=!t&&!n&&!r;(i||t)&&function(e,t){for(var n=[],r=[],i=null,c={rightLink:e.firstNoteId},a=0;a<e.notes.size;a++)i=c.rightLink,r=[],(c=e.notes.get(i)).preview.replace(/(<([^>]+)>)/gi,"").toLowerCase().includes(t.searchText)&&(r=[c],"#ededed"!==t.colorFilter&&t.colorFilter!==c.colorPreview&&(r=[]),r.length&&t.collectionFilter&&t.threadFilter?c.thread.length||c.collection.length||(r=[]):r.length&&t.threadFilter?c.thread.length||(r=[]):r.length&&t.collectionFilter&&(c.collection.length||(r=[])),r.length&&e.openedCollectionId&&(e.notes.get(e.openedCollectionId).collection.includes(c.id)||(r=[])),r.length&&(n=c.pinned?[Object(h.d)(r[0])].concat(Object(o.a)(n)):[].concat(Object(o.a)(n),[Object(h.d)(r[0])])));e.search=n}(e,O),(i||n)&&function(e){var t=[],n=e.workspaceIds.flatMap((function(n,o){return C(e,n,o,t,"noteOfWorkspaceNotFoundError!")}));e.workspace=n,t.length&&(e.workspaceIds=T(t,e.workspaceIds))}(e),(i||r)&&P(e,N,pe),v(e)},ke=function(e){if(e.notes.size>1){var t=e.notes.get(e.firstNoteId),n=null,o=null;if(!t||t.leftLink)return console.log("first note problem: ",t),!1;if(!t.rightLink)return console.log("first note has no right link"),!1;n=e.notes.get(t.rightLink);for(var r=1;r<e.notes.size-1;r++){if(!n||!n.rightLink)return console.log("an element doesnt have a successor or the current element does not exist"),!1;if(!(o=e.notes.get(n.rightLink)))return console.log("the successor does not exist"),!1;if(!(n.rightLink&&n.leftLink&&t.rightLink&&o.leftLink&&n.leftLink===t.id&&n.rightLink===o.id))return console.log("sequence disconnected at: ",Object(s.a)({},t),Object(s.a)({},n),Object(s.a)({},o)),!1;t=n,n=o}if(!n.leftLink||n.rightLink)return console.log("last note has a right link"),!1}return!0},we=function(){var e=Object(c.a)(i.a.mark((function e(){var t,n,o,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(s.a)({},b),n=Object(h.h)(),t.notes.set(n.id,n),t.selectedNoteId=n.id,(o=t.notes.get(t.firstNoteId))&&(n.rightLink=t.firstNoteId,o.leftLink=n.id),t.firstNoteId=n.id,t.openedCollectionId&&((r=t.notes.get(t.openedCollectionId)).collection.push(n.id),be(r,"meta")),Z.notes.put(n),be(n,"meta"),o&&be(o,"meta"),ve(t),ne("editor");case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=Object(c.a)(i.a.mark((function e(t,n,o){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(s.a)({},b),"get-occurrences"===n&&Se(r),r.notes.set(t.id,t),r.selectedNoteId=t.id,o&&Ce(t,r),be(t,"both"),ve(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(c.a)(i.a.mark((function e(t,n,o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o||(o=Object(s.a)({},b)),G(t,n,o,$,_,pe,ve),$&&_(!1);case 3:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}(),je=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R(b,$,M,B,N,pe,ve,t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.openedWorkspaceId?alert(p.d):M?((t=Object(s.a)({},b)).workspaceIds=Object(o.a)(new Set(Object(o.a)(t.workspaceIds))),ve(t),B(!1)):B(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(t,$,_,b,ve,xe);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=Object(c.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z(t,n,_,b,pe,M,ve,Oe);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Le=function(){var e=Object(c.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n||(n=Object(s.a)({},b)),U(t,n,pe,M),t||ve(n);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Se=function(){var e=Object(c.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Le(!0,t),t.workspaceIds=Object(o.a)(b.notes.keys()).filter((function(e){return b.notes.get(e).thread.includes(b.selectedNoteId)||b.notes.get(e).collection.includes(b.selectedNoteId)})),B(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ne=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(b);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(c.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Z.notes.get(b.selectedNoteId).then((function(e){b.notes.set(b.selectedNoteId,e),ne("editor")}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=Object(s.a)({},b)).openedCollectionId=null,ve(t,!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ce=function(e,t){var n=!1;t||(n=!0,t=Object(s.a)({},b));var o,r=null,i=Object(a.a)(t.notes);try{for(i.s();!(o=i.n()).done;){var c=Object(d.a)(o.value,2)[1];c.rightLink||(r=c)}}catch(l){i.e(l)}finally{i.f()}r&&(Object(h.f)(t,e),r.rightLink=e.id,e.leftLink=r.id,delete e.rightLink,n&&ve(t,!0))};return Object(H.jsxs)("div",{children:["notes"===te&&Object(H.jsx)(l.Suspense,{fallback:h.m,children:Object(H.jsx)(V,{darkMode:de,dashboard:b,handleOnDragEnd:je,GAPIloaded:r,currentUser:u,setCurrentPage:ne,notesUpdating:he,setDarkMode:le,closeCollection:Te,addNote:we,selectNote:ye,mergeMode:$,setMergeMode:_,openEditor:Pe,rootsOrBranches:N,closeAndSave:Le,threadOrCollection:M,threadOrCollectionManage:me,setRootsOrBranches:A,searchProps:O,setSearchProps:j,synchNotes:ge})}),"editor"===te&&b.selectedNoteId&&Object(H.jsx)(l.Suspense,{fallback:h.m,children:Object(H.jsx)(K,{setCurrentPage:ne,dashboard:b,updateNote:Ie,deleteNote:Oe,darkMode:de,exportThread:Ne,threadCollectionSwap:function(e){var t,n=Object(s.a)({},b),r=n.notes.get(n.selectedNoteId);e?((t=r).collection=Object(o.a)(new Set(Object(o.a)(t.thread))),t.thread=[]):(!function(e){e.thread=e.collection,e.collection=[]}(r),F(n,r.thread,pe),n.openedCollectionId===n.selectedNoteId&&(n.openedCollectionId=null)),n.openedWorkspaceId===n.selectedNoteId&&B(!M),ve(n),be(r,"meta"),ne("notes")},moveToTheEnd:Ce})}),Object(H.jsx)("iframe",{title:"printer",id:"ifmcontentstoprint",style:{height:"0px",width:"0px",position:"absolute",border:"0"}}),"settings"===te&&Object(H.jsx)(l.Suspense,{fallback:h.m,children:Object(H.jsx)(J,{setCurrentPage:ne,signInFunction:t,signOutFunction:n,loadedUser:u,GAPIloaded:r})})]})}},64:function(e,t,n){},7:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"j",(function(){return c})),n.d(t,"f",(function(){return a})),n.d(t,"m",(function(){return s})),n.d(t,"g",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"n",(function(){return u})),n.d(t,"e",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"l",(function(){return p})),n.d(t,"k",(function(){return g})),n.d(t,"h",(function(){return b}));var o="cannot insert a note inside its own Thread or Collection",r="Please close your workspace before changing between Thread Mode and Collection Mode.",i="Character limit reached. Additional content will not be saved. Please start a new note instead.",c="Merge Mode is on, please select another card to merge to the pink card. The content, links and references of the card you select will be copied. If you want to exit it, press the button again.",a="Google Drive is not connected. Please Login from the Settings page to allow the backup.",s="------------------------------------------------------------ new note ---------------------------------------------------",d="--------------------------------------------------------- exported thread -------------------------------------------\n",l="Merge Mode is on. Please finish merging or exit the Merge Mode before doing anything else.",u="Workspace length limit reached. Please save and start a new Workspace instead.",f="The note you want to delete compares in the branches of other notes. If you proceed, the system will automatically redirect the links of the other notes to preserve the connectivity. Otherwise, please restructure your links manually until this alert disappears.",h="The number of links of the resulting note would exceed the limit. Please remove some links to continue.",p="The size of the Thread or Collection of the resulting note would exceed the limit. Please remove some notes manually to continue.",g="The size of the resulting text exceeds the limit. Please shorten some text to continue.",b="Both the cards contain a Thread or a Collection and this generates a conflict in the mergin process. Please empty the Thread or Collection of one of the two notes and try again."}},[[145,3,4]]]);
//# sourceMappingURL=main.5f51414b.chunk.js.map