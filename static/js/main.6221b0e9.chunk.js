(this.webpackJsonpthinkythreads=this.webpackJsonpthinkythreads||[]).push([[2],{110:function(e,t){},146:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n(34),i=n.n(r),c=(n(65),n(2)),a=n.n(c),s=n(6),d=n(54),l=n(55),u=n(60),f=n(59),h=n(23),p=n(9),g="https://www.googleapis.com/auth/drive.file",b="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",v=function(e){Object(u.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(d.a)(this,n);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={googleAuth:"",currentUser:localStorage.getItem("currentUser"),loaded:!1,driveFolderId:"",onlineState:window.navigator.onLine},e.initScript=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.querySelector("meta[name=viewport]")).setAttribute("content",n.content+", height="+window.innerHeight+", user-scalable=no"),window.addEventListener("online",(function(){return e.setState({onlineState:!0})})),window.addEventListener("offline",(function(){return e.setState({onlineState:!1})})),e.state.onlineState&&e.loadGAPI();case 5:case"end":return t.stop()}}),t)}))),e.loadGAPI=Object(s.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=document.createElement("script")).onload=e.handleClientLoad,n.src="https://apis.google.com/js/api.js",document.body.appendChild(n),console.log("loadingGAPI");case 5:case"end":return t.stop()}}),t)}))),e.initClient=Object(s.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{window.gapi.client.init({apiKey:"AIzaSyDmfaKWGbmsMVLYu1nu83egzWI30vgyD-0",clientId:"455375017729-n44ea0ohjt7hb6jpi5ks56ej89cppv93.apps.googleusercontent.com",scope:g,discoveryDocs:[b]}).then((function(){e.setState({googleAuth:window.gapi.auth2.getAuthInstance(),loaded:!0}),e.state.googleAuth.isSignedIn.listen(e.updateSigninStatus),e.state.googleAuth.then(e.setSigninStatus())}))}catch(n){console.log(n)}case 1:case"end":return t.stop()}}),t)}))),e.signInFunction=function(){e.state.googleAuth.signIn()},e.signOutFunction=function(){e.state.googleAuth.signOut()},e.updateSigninStatus=function(){e.setSigninStatus()},e.setSigninStatus=function(){var t=e.state.googleAuth.currentUser.get();t.isSignedIn()?t.hasGrantedScopes(g)&&localStorage.setItem("currentUser",t.getBasicProfile().getName()):localStorage.setItem("currentUser",null);e.setState({currentUser:localStorage.getItem("currentUser")})},e.handleClientLoad=function(){window.gapi.load("client:auth2",e.initClient)},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.initScript()}},{key:"componentDidUpdate",value:function(){this.state.onlineState&&!this.state.loaded&&this.loadGAPI()}},{key:"render",value:function(){console.log(localStorage.getItem("currentPage")),console.log(localStorage.getItem("currentUser"));var e=null!==this.state.currentUser&&"null"!==this.state.currentUser;return Object(p.jsx)(h.f,{signInFunction:this.signInFunction,signOutFunction:this.signOutFunction,GAPIloaded:this.state.loaded&&this.state.onlineState,currentUser:e})}}]),n}(o.Component),O=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function w(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var I=function(e){e&&e instanceof Function&&n.e(10).then(n.bind(null,372)).then((function(t){var n=t.getCLS,o=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),o(e),r(e),i(e),c(e)}))};i.a.render(Object(p.jsx)(v,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/thinkythreads",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/thinkythreads","/service-worker.js");O?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):w(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):w(t,e)}))}}(),I()},23:function(e,t,n){"use strict";n.d(t,"a",(function(){return ie})),n.d(t,"d",(function(){return ce})),n.d(t,"c",(function(){return ae})),n.d(t,"b",(function(){return se})),n.d(t,"g",(function(){return de})),n.d(t,"i",(function(){return le})),n.d(t,"h",(function(){return ue})),n.d(t,"e",(function(){return fe}));var o=n(2),r=n.n(o),i=n(6),c=n(0),a=n(4),s=n(5),d=n(1),l=n.n(d),u=n(56),f=n(3),h=n(8);function p(e,t){return window.gapi.client.request({path:"upload/drive/v3/files/"+t,method:"PATCH",params:{uploadType:"media"},body:e.text})}function g(e){return{description:JSON.stringify({id:e.id,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg}),appProperties:{version:e.version}}}function b(e,t){return window.gapi.client.request({path:"drive/v3/files/"+t,method:"PATCH",body:g(e)})}function v(e,t){return t||(t=g(e)),t.mimeType="application/json",t.name=e.id,t.fields="id",t.parents=[le],window.gapi.client.drive.files.create({resource:t})}function O(e){return window.gapi.client.drive.files.list({q:"name='"+e.id+"' and mimeType='application/json' and trashed=false and '"+le+"' in parents"})}function w(e){return window.gapi.client.drive.files.get({mimeType:"application/json",fileId:e,alt:"media"})}function I(e,t,n){for(var o=arguments.length,r=new Array(o>3?o-3:0),i=3;i<o;i++)r[i-3]=arguments[i];if(console.error(e),t+=1,e.result&&-1===e.result.error.code&&t<2||t<4)setTimeout((function(){n.apply(void 0,r.concat([t]))}),1e3);else if(n===S||n===E){var c=r[2];c((function(e){return e-1}))}}function j(e,t,n){e.version=parseInt(e.version)+1;var o=Object(a.a)({},e);Object(f.e)(e),de&&(n((function(e){return e+1})),S(o,t,n)),"meta"===t?(delete o.text,fe.notes.update(o.id,o)):fe.notes.put(o)}function m(e,t,n){fe.notes.get(e).then((function(e){return setTimeout((function(){n((function(e){return e+1})),S(e,"both",n)}),200*t)}))}var k=n(53);function y(e,t){t||(t=0),p({text:JSON.stringify({notesOrder:e.notesOrder,notesEverDeleted:e.notesEverDeleted})},ue.id).then().catch((function(n){return I(n,t,y,e)}))}function S(e,t,n,o){o||(o=0),O(e).then((function(r){if(r.result.files.length){var i=r.result.files[0].id,c=null;"media"===t||"both"===t?c=p:"meta"===t&&(c=b),c(e,i).then((function(o){"both"===t?S(e,"meta",n):(console.log("updated"),n((function(e){return e-1})))})).catch((function(r){return I(r,o,S,e,t,n)}))}else v(e).then((function(){"meta"!==t?S(e,"media",n):n((function(e){return e-1}))})).catch((function(r){return I(r,o,S,e,t,n)}))})).catch((function(r){return I(r,o,S,e,t,n)}))}function x(e,t){e.checkedAgainstDrive?(console.log("updateconfig"),t||(t=0),w(ue.id).then((function(t){var n=JSON.parse(t.body).notesOrder;k.isEmpty(k.xor(e.notesOrder,n))||(e.notesOrder=Object(c.a)(new Set([].concat(Object(c.a)(e.notesOrder),Object(c.a)(n)))),window.localStorage.setItem("notes-order",e.notesOrder));var o=JSON.parse(t.body).notesEverDeleted;k.isEmpty(k.xor(e.notesEverDeleted,o))||(e.notesEverDeleted=Object(c.a)(new Set([].concat(Object(c.a)(e.notesEverDeleted),Object(c.a)(o)))),window.localStorage.setItem("notes-ever-deleted",e.notesEverDeleted)),y(e)})).catch((function(n){return 404===n.status?console.log(!0):I(n,t,x,e)}))):console.log("blocked")}function N(e,t,n){console.log("deleted");var o=t.findIndex((function(t){return t===e.id}));if(-1!==o){var r=Object(f.i)(t,o);n(r),window.localStorage.setItem("deleted-notes",JSON.stringify(r))}}function E(e,t,n,o,r){r||(r=0),O(e).then((function(i){i.result.files.length?window.gapi.client.drive.files.delete({fileId:i.result.files[0].id}).then((function(){N(e,t,n),o((function(e){return e-1}))})).catch((function(i){return I(i,r,E,e,t,n,o)})):N(e,t,n)})).catch((function(i){return I(i,r,E,e,t,n,o)}))}function P(e){fe.notes.bulkGet(e.notes.get(e.selectedNoteId).thread).then((function(e){var t=e.map((function(e){return e.text})),n=h.g+t.reduce((function(e,t){return e+h.m+t})),o=document.getElementById("ifmcontentstoprint").contentWindow;o.document.open(),o.document.write(n),o.document.close(),o.focus(),o.print()}))}function T(e,t){console.log("checkingfolder"),t||(t=0),window.gapi.client.drive.files.list({q:"name='thinkythreads-data' and mimeType='application/vnd.google-apps.folder' and trashed=false"}).then((function(n){if(n.result.files.length)n.result.files[0].id!==le&&e(n.result.files[0].id);else{window.gapi.client.drive.files.create({resource:{name:"thinkythreads-data",mimeType:"application/vnd.google-apps.folder"},fields:"id"}).then((function(t){e(t.result.id)})).catch((function(n){return I(n,t,T,e)}))}})).catch((function(n){return I(n,t,T,e)}))}var A=n(11),C=n(53);function D(e,t,n,o,r,i,a){e.configFound?w(e.configFound).then((function(s){if(""!==s.body){var d=JSON.parse(s.body),l=Object(c.a)(t.notes.keys()),u=l.filter((function(e){return!d.notesEverDeleted.includes(e)}));a||l.length!==u.length?function(e,t,n){e.notesEverDeleted=t.notesEverDeleted;var o,r=!0,i=Object(A.a)(e.notesEverDeleted);try{var a=function(){var t=o.value;if(e.notes.get(t)){e.notes.delete(t);var n=e.notesOrder.find((function(e){return e===t}));n&&(e.notesOrder=Object(f.i)(e.notesOrder,n))}};for(i.s();!(o=i.n()).done;)a()}catch(s){i.e(s)}finally{i.f()}e.notesEverDeleted.includes(e.selectedNoteId)&&(e.selectedNoteId=null);e.notesEverDeleted.includes(e.openedCollectionId)&&(e.openedCollectionId=null);e.notesEverDeleted.includes(e.openedWorkspaceId)&&(e.openedWorkspaceId=null);e.workspaceIds=e.workspaceIds.filter((function(t){return!e.notesEverDeleted.includes(t)})),C.isEmpty(C.xor(Object(c.a)(e.notes.keys()),t.notesOrder))?e.notesOrder=t.notesOrder:(e.notesOrder=Object(c.a)(new Set([].concat(Object(c.a)(e.notesOrder),Object(c.a)(t.notesOrder)))),r=!1);if(window.localStorage.setItem("notes-order",JSON.stringify(e.notesOrder)),window.localStorage.setItem("notes-ever-deleted",JSON.stringify(e.notesEverDeleted)),e.checkedAgainstDrive=!0,!r)return!0;n(e)}(t,d,n)&&R(t,e,o,r,i,n):R(t,e,o,r,i,n)}else R(t,e,o,r,i,n)})):a?(t.notesOrder=Object(c.a)(new Set([t.notesOrder].concat(Object(c.a)(t.notes.keys())))),t.checkedAgainstDrive=!0,x(t),n(t)):R(t,e,o,r,i,n)}function W(e,t,n,o,r,i,c,a,s){s||(s=0),w(n.result.files[o].id).then((function(s){return function(e,t,n,o,r,i,c,a,s){var d=JSON.parse(n.result.files[r].description);d.text=o.body,d.version=parseInt(n.result.files[r].appProperties.version),e.notes.set(d.id,d),fe.notes.put(d).then(Object(f.e)(d)),t.finishedProcesses+=1,a((function(e){return e-1})),t.finishedProcesses===n.result.files.length&&(n.result.nextPageToken?F(e,t,i,c,a,s,n.result.nextPageToken):D(t,e,s,i,c,a,!0))}(e,t,n,s,o,r,i,c,a)})).catch((function(d){return I(d,s,W,e,t,n,o,r,i,c,a)}))}function F(e,t,n,o,r,i,c,a){a||(a=0),window.gapi.client.drive.files.list({fields:"nextPageToken, files(description, id, name, appProperties)",q:"mimeType='application/json' and trashed=false and '"+le+"' in parents",pageToken:c}).then((function(c){!function(e,t,n,o,r,i,c){t.finishedProcesses=0;for(var a=0;a<n.result.files.length;a++){var s=n.result.files[a],d=s.name;if("___config"===d)t.configFound=s.id,ue.id=s.id,t.finishedProcesses+=1;else if(o.includes(d))t.finishedProcesses+=1;else{var l=parseInt(s.appProperties.version);t.set(d,l);var u=e.notes.get(d);!u||l>u.version?(t.mightNeedUpdate=!1,W(e,t,n,a,o,r,i,c),i((function(e){return e+1}))):t.finishedProcesses+=1}}t.mightNeedUpdate?n.result.nextPageToken?F(e,t,o,r,i,c,n.result.nextPageToken):D(t,e,c,o,r,i):t.mightNeedUpdate||n.result.nextPageToken||t.finishedProcesses!==n.result.files.length||D(t,e,c,o,r,i,!0)}(e,t,c,n,o,r,i)})).catch((function(s){return I(s,a,F,e,t,n,o,r,i,c)}))}function R(e,t,n,o,r,i){var a,d=0,l=Object(A.a)(e.notes);try{for(l.s();!(a=l.n()).done;){var u=Object(s.a)(a.value,2),f=u[0],h=u[1],p=t.get(f);(!p||p<h.version)&&m(f,d+=1,r)}}catch(O){l.e(O)}finally{l.f()}var g,b=Object(A.a)(n);try{var v=function(){var e=g.value;d+=1,setTimeout((function(){r((function(e){return e+1})),E({id:e},n,o,r)}),200*d)};for(b.s();!(g=b.n()).done;)v()}catch(O){b.e(O)}finally{b.f()}e.checkedAgainstDrive=!0,!d&&t.configFound||(e.notesOrder.length!==e.notes.size&&(e.notesOrder=Object(c.a)(new Set([].concat(Object(c.a)(e.notesOrder),Object(c.a)(e.notes.keys()))))),x(e)),i(e)}function M(e,t){for(var n=[],o=[],r=[],i=0;i<e.notesOrder.length;i++){var a=e.notesOrder[i],s=e.notes.get(a);s?(o=[],s.preview.replace(/(<([^>]+)>)/gi,"").toLowerCase().includes(t.searchText)&&(o=[s],"#ededed"!==t.colorFilter&&t.colorFilter!==s.colorPreview&&(o=[]),o.length&&t.collectionFilter&&t.threadFilter?s.thread.length||s.collection.length||(o=[]):o.length&&t.threadFilter?s.thread.length||(o=[]):o.length&&t.collectionFilter&&(s.collection.length||(o=[])),o.length&&e.openedCollectionId&&(e.notes.get(e.openedCollectionId).collection.includes(s.id)||(o=[])),o.length&&(n=s.pinned?[Object(f.d)(o[0])].concat(Object(c.a)(n)):[].concat(Object(c.a)(n),[Object(f.d)(o[0])])))):(r.push(i),H("noteOfSearchNotFoundError!",a,e))}r.length&&(e.notesOrder=L(r,e.notesOrder),window.localStorage.setItem("notes-order",JSON.stringify(e.notesOrder)),x(e)),e.notesOrder.length&&e.notesOrder.length!==e.notes.size&&(e.notesOrder=Object(c.a)(new Set([e.notesOrder].concat(Object(c.a)(e.notes.keys())))),de&&(window.localStorage.setItem("notes-order",JSON.stringify(e.notesOrder)),x(e)),window.alert("-------- BETA VERSION ERROR REPORT ------- \n---- PLEASE SHARE WITH THE DEVELOPER --- \nalong with some info about what you did to get here \nEMAIL: nicolamendini0@gmail.com \nTHANK YOU!\n\nERROR: \nThe order of the notes was lost")),e.search=n}function U(e){var t=[],n=e.workspaceIds.flatMap((function(n,o){return G(e,n,o,t,"noteOfWorkspaceNotFoundError!")}));e.workspace=n,t.length&&(e.workspaceIds=L(t,e.workspaceIds))}function J(e,t,n){if(e.selectedNoteId){var o=e.notes.get(e.selectedNoteId),r=[];t?(e.links=o.roots.flatMap((function(t,n){return G(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.roots=L(r,o.roots),j(o,"meta",n))):(e.links=o.branches.flatMap((function(t,n){return G(e,t,n,r,"noteOfLinksNotFoundError")})),r.length&&(o.branches=L(r,o.branches),j(o,"meta",n)))}else e.links=[]}function L(e,t){return t.filter((function(t,n){return!e.includes(n)}))}function G(e,t,n,o,r){return e.notes.get(t)?[Object(f.d)(e.notes.get(t))]:(o.push(n),H(r,t,e),[])}function H(e,t,n){window.alert("-------- BETA VERSION ERROR REPORT ------- \n---- PLEASE SHARE WITH THE DEVELOPER --- \nalong with some info about what you did to get here \nEMAIL: nicolamendini0@gmail.com \nTHANK YOU!\n\nERROR: \n"+e+"\n\nNOTE: \n"+t+"\n\n\nNOTES-ORDER: \n"+n.notesOrder+"\n\nLINKS: \n"+n.links+"\n\nWORKSPACE-IDS: \n"+n.workspaceIds)}function B(e,t,n){e.openedWorkspaceId===t||(e.workspaceIds=Object(f.a)(e.workspaceIds,n,t),e.selectedNoteId=t)}function z(e,t){var n=!e.branches.includes(t.id),o=e.id!==t.id,r=e.branches.length<ie,i=!t.roots.includes(e.id),c=t.roots.length<ie;if(n&&o&&r&&i&&c)return e.branches.push(t.id),t.roots.push(e.id),!0}function q(e,t,n){var o,r=Object(A.a)(e.notes);try{for(r.s();!(o=r.n()).done;)for(var i=Object(s.a)(o.value,2)[1],c=1;c<i.thread.length;c++)if(i.thread[c-1]===t.id&&i.thread[c]===n.id)return alert("The link you are tying to delete is used in the Thread : "+Object(f.f)(i)+"... \nPlease restructure this Thread it if you desire to proceed."),!1}catch(d){r.e(d)}finally{r.f()}var a=t.branches.findIndex((function(e){return e===n.id}));return-1!==a&&(t.branches=Object(f.i)(t.branches,a)),-1!==(a=n.roots.findIndex((function(e){return e===t.id})))&&(n.roots=Object(f.i)(n.roots,a)),!0}function K(e,t,n){for(var o=0,r=function(r){var i=e.notes.get(t[r-1]),c=e.notes.get(t[r]);z(i,c)&&setTimeout((function(){j(i,"meta",n),j(c,"meta",n)}),200*(o+=1))},i=1;i<t.length;i++)r(i)}function V(e,t,n,o){Y(!0,t,n,o);var r=t.notes.get(t.selectedNoteId);t.workspaceIds=e?Object(c.a)(r.thread):Object(c.a)(r.collection),t.openedWorkspaceId=t.selectedNoteId}function Y(e,t,n,o){if(t.openedWorkspaceId||!t.workspaceIds.length||e||window.confirm("You have an "+(o?"unsaved thread":"unsaved collection")+", do you wish to delete it and clean the Workspace?")){if(t.openedWorkspaceId){var r=t.notes.get(t.openedWorkspaceId),i=!1;o?(i=Object(f.b)(r.thread,t.workspaceIds))&&(r.thread=t.workspaceIds,K(t,r.thread,n)):(i=Object(f.b)(r.collection,t.workspaceIds))&&(r.collection=t.workspaceIds),i&&j(r,"meta",n),t.openedWorkspaceId=null}t.workspaceIds=[]}}function _(e,t,n,o,r,i,c){if(t)e.id!==o.selectedNoteId?e.thread.length&&o.notes.get(o.selectedNoteId).collection.length||o.notes.get(o.selectedNoteId).thread.length&&e.collection.length?alert(h.h):c(o.notes.get(o.selectedNoteId),e):n(!1);else if(!o.selectedNoteId||o.selectedNoteId!==e.id){o.selectedNoteId=e.id;var s=Object(a.a)({},o);s.selectedNoteId=e.id,i(s),r(s)}}function $(e,t,n,o,r,i,c,s,d,l){if(null!==l.destination)if(n)alert(h.a);else if("search-area"===l.source.droppableId){if("workspace-area"===l.destination.droppableId){var u=e.search[l.source.index].id;if(e.workspaceIds.length>ce)alert(h.n);else if(o){var p=Object(a.a)({},e);B(p,u,l.destination.index),J(p,i,s),U(p),t(p)}else if((!e.openedWorkspaceId||e.openedWorkspaceId!==u)&&!e.workspaceIds.includes(u)){var g=Object(a.a)({},e);g.workspaceIds.push(u),U(g),t(g)}}else if("branches-area"===l.destination.droppableId){var b=Object(a.a)({},e),v=b.notes.get(e.search[l.source.index].id),O=b.notes.get(e.selectedNoteId);i?z(v,O)&&(j(O,"meta",s),j(v,"meta",s)):z(O,v)&&(j(O,"meta",s),j(v,"meta",s)),J(b,i,s),t(b)}else if("wrapper-area"===l.destination.droppableId){var w=Object(a.a)({},e),I=e.search[l.source.index];e.workspaceIds.length>0?function(e,t,n,o){if(!e.notes.get(t).thread.length&&!e.notes.get(t).collection.length)if(e.workspaceIds.includes(t))alert(h.b);else{var r=e.notes.get(t);o?(r.thread=e.workspaceIds,K(e,r.thread,n)):r.collection=e.workspaceIds,e.selectedNoteId=t,V(o,e,n,o),j(r,"meta",n)}}(w,I.id,s,o):I.thread.length?(w.selectedNoteId=I.id,V(!0,w,s,o),r(!0)):I.collection.length&&(w.selectedNoteId=I.id,V(!1,w,s,o),r(!1)),d(w)}else if("search-area"===l.destination.droppableId){if(l.source.index!==l.destination.index){var m=e.search[l.source.index],k=e.search[l.destination.index];if(!(!k.pinned&&m.pinned||!m.pinned&&k.pinned)){var y=Object(a.a)({},e);y.notesOrder=Object(f.h)(e.notesOrder,e.notesOrder.findIndex((function(e){return e===m.id})),e.notesOrder.findIndex((function(e){return e===k.id}))),window.localStorage.setItem("notes-order",JSON.stringify(y.notesOrder)),de&&x(y),y.selectedNoteId=m.id,J(y,i,s),M(y,c),t(y)}}}else if("search-bar"===l.destination.droppableId){var S=Object(a.a)({},e),N=e.search[l.source.index];S.openedCollectionId=N.id,M(S,c),t(S)}}else if("workspace-area"===l.source.droppableId){if("search-area"===l.destination.droppableId){var E=Object(a.a)({},e);E.workspaceIds=Object(f.i)(E.workspaceIds,l.source.index),l.source.index>0&&o&&(E.selectedNoteId=E.workspaceIds[l.source.index-1],J(E,i,s)),U(E),t(E)}else if("workspace-area"===l.destination.droppableId){var P=Object(a.a)({},e);P.workspaceIds=Object(f.h)(P.workspaceIds,l.source.index,l.destination.index),P.selectedNoteId=P.workspaceIds[l.destination.index],J(P,i,s),U(P),t(P)}}else if("branches-area"===l.source.droppableId)if("search-area"===l.destination.droppableId){var T=Object(a.a)({},e),A=T.notes.get(e.links[l.source.index].id),C=T.notes.get(e.selectedNoteId);i?q(T,A,C)&&(j(C,"meta",s),j(A,"meta",s)):q(T,C,A)&&(j(C,"meta",s),j(A,"meta",s)),J(T,i,s),M(T,c),t(T)}else if("workspace-area"===l.destination.droppableId)if(e.workspaceIds.length>ce)alert(h.n);else{var D=Object(a.a)({},e);B(D,e.links[l.source.index].id,l.destination.index),J(D,i,s),U(D),t(D)}else if("branches-area"===l.destination.droppableId){var W=Object(a.a)({},e),F=W.notes.get(W.selectedNoteId);i?F.roots=Object(f.h)(F.roots,l.source.index,l.destination.index):F.branches=Object(f.h)(F.branches,l.source.index,l.destination.index),j(F,"meta",s),J(W,i,s),t(W)}}function Q(e,t,n,o,r,i,a,d,l){var u=n.notes.get(e);if(Object(f.c)(n,e)||o){n.notes.delete(e),n.notesOrder=Object(f.i)(n.notesOrder,n.notesOrder.findIndex((function(t){return t===e})));var p=[].concat(Object(c.a)(i),[e]);if(a(p),n.notesEverDeleted.push(e),window.localStorage.setItem("notes-order",JSON.stringify(n.notesOrder)),window.localStorage.setItem("deleted-notes",JSON.stringify(p)),window.localStorage.setItem("notes-ever-deleted",JSON.stringify(n.notesEverDeleted)),o)r(!1);else{var g,b=0,v=Object(A.a)(n.notes);try{var O=function(){var t=Object(s.a)(g.value,2)[1],n=t.collection.findIndex((function(t){return t===e}));-1!==n&&(t.collection=Object(f.i)(t.collection,n),setTimeout((function(){j(t,"meta",d)}),200*(b+=1)))};for(v.s();!(g=v.n()).done;)O()}catch(w){v.e(w)}finally{v.f()}n.openedWorkspaceId===e&&(n.openedWorkspaceId=null),n.openedCollectionId===e&&(n.openedCollectionId=null),n.selectedNoteId===e&&(n.selectedNoteId=null)}de&&(d((function(e){return e+1})),E(u,p,a,d),x(n)),fe.notes.delete(e),l(n)}else(t||window.confirm(h.e))&&(!function(e,t,n){var o,r=!1,i=0,c=Object(A.a)(e.notes);try{var a=function(){var c=Object(s.a)(o.value,2)[1];c.branches.includes(t)&&(c.branches=c.branches.filter((function(e){return e!==t})),r=!0),c.roots.includes(t)&&(c.roots=c.roots.filter((function(e){return e!==t})),r=!0),c.thread.includes(t)&&(c.thread=c.thread.filter((function(e){return e!==t})),K(e,c.thread,n),r=!0),r&&setTimeout((function(){j(c,"meta",n)}),200*(i+=1)),r=!1};for(c.s();!(o=c.n()).done;)a()}catch(w){c.e(w)}finally{c.f()}}(n,e,d),Q(e,!1,n,o,r,i,a,d,l))}function X(e,t,n,o,r,i,d,l){var u=Object(c.a)(new Set([].concat(Object(c.a)(e.branches),Object(c.a)(t.branches)))),p=Object(c.a)(new Set([].concat(Object(c.a)(e.roots),Object(c.a)(t.roots)))),g=Object(c.a)(new Set([].concat(Object(c.a)(e.collection),Object(c.a)(t.collection)))),b=[].concat(Object(c.a)(e.thread),Object(c.a)(t.thread));return u.length>ie||p.length>ie?(alert(h.i),void n(!1)):g.length>ce||b.length>ce?(alert(h.l),void n(!1)):void fe.notes.get(e.id).then((function(c){return fe.notes.get(t.id).then((function(v){var O=c.text+" "+v.text;if(O.length>ae)return alert(h.k),void n(!1);var w=Object(a.a)({},o),I={id:e.id,text:O,branches:u,roots:p,thread:b,collection:g,pinned:e.pinned||t.pinned,color:"#ffffff"!==e.color?e.color:t.color,colorPreview:"#ffffff"!==e.colorPreview?e.colorPreview:t.colorPreview,version:e.version};Object(f.j)(I),I.branches=I.branches.filter((function(n){return n!==e.id&&n!==t.id})),I.roots=I.roots.filter((function(n){return n!==e.id&&n!==t.id})),I.collection=I.collection.filter((function(n){return n!==e.id&&n!==t.id})),I.thread=I.thread.filter((function(n){return n!==e.id&&n!==t.id})),K(w,I.thread,r),w.notes.set(I.id,I);var m,k=!1,y=0,S=Object(A.a)(w.notes);try{var x=function(){var n=Object(s.a)(m.value,2)[1];n.thread.includes(t.id)&&(n.thread=n.thread.flatMap((function(n){return n===t.id?[e.id]:[n]})),k=!0),n.collection.includes(t.id)&&(n.collection.includes(I.id)||n.collection.push(I.id),n.collection=n.collection.filter((function(e){return e!==t.id})),k=!0),n.branches.includes(t.id)&&(n.branches.includes(I.id)||z(n,I),n.branches=n.branches.filter((function(e){return e!==t.id})),k=!0),n.roots.includes(t.id)&&(n.roots.includes(I.id)||z(I,n),n.roots=n.roots.filter((function(e){return e===t.id})),k=!0),k&&setTimeout((function(){j(n,"meta",r)}),200*(y+=1)),k=!1};for(S.s();!(m=S.n()).done;)x()}catch(N){S.e(N)}finally{S.f()}!i&&o.workspaceIds.includes(e.id)?w.workspaceIds=w.workspaceIds.filter((function(e){return e!==t.id})):w.workspaceIds=w.workspaceIds.flatMap((function(n){return n===t.id?[e.id]:[n]})),w.openedCollectionId===t.id&&(w.openedCollectionId=I.id),w.openedWorkspaceId!==t.id&&w.openedWorkspaceId!==e.id||(w.openedWorkspaceId=I.id,w.workspaceIds=w.workspaceIds.filter((function(n){return n!==t.id&&n!==e.id}))),w.selectedNoteId=I.id,j(I,"both",r),l(t.id,!1,w),d(w)}))}))}n(145);var Z=n(58),ee=n.n(Z),te=n(9);window.katex=ee.a;var ne=l.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(5),n.e(8)]).then(n.bind(null,374))})),oe=l.a.lazy((function(){return Promise.all([n.e(0),n.e(7)]).then(n.bind(null,375))})),re=l.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(6),n.e(9)]).then(n.bind(null,373))})),ie=150,ce=300,ae=1048576,se=200,de=!1,le="",ue={id:""},fe=new u.a("notes-db");fe.version(1).stores({notes:"id, text, preview, branches, roots, thread, collection, pinned, color, colorPreview, attachedImg, version"});t.f=function(e){var t=e.signInFunction,n=e.signOutFunction,o=e.GAPIloaded,l=e.currentUser,u=Object(d.useState)({notes:new Map,notesOrder:[],notesEverDeleted:[],workspaceIds:[],selectedNoteId:null,openedCollectionId:null,openedWorkspaceId:null,search:[],links:[],workspace:[],checkedAgainstDrive:!0}),p=Object(s.a)(u,2),g=p[0],b=p[1],v=Object(d.useState)({searchText:"",threadFilter:!1,collectionFilter:!1,colorFilter:"#ededed"}),O=Object(s.a)(v,2),w=O[0],I=O[1],m=Object(d.useState)([]),k=Object(s.a)(m,2),y=k[0],S=k[1],N=Object(d.useState)(!1),E=Object(s.a)(N,2),A=E[0],C=E[1],D=Object(d.useState)(!1),W=Object(s.a)(D,2),R=W[0],L=W[1],G=Object(d.useState)(!1),H=Object(s.a)(G,2),B=H[0],z=H[1],q=Object(d.useState)("notes"),V=Object(s.a)(q,2),Z=V[0],ee=V[1],ie=Object(d.useState)(null),ce=Object(s.a)(ie,2),ae=ce[0],se=ce[1],ue=Object(d.useState)(!1),he=Object(s.a)(ue,2),pe=he[0],ge=he[1],be=Object(d.useState)(0),ve=Object(s.a)(be,2),Oe=ve[0],we=ve[1];Object(d.useEffect)((function(){var e=Object(a.a)({},g);fe.notes.toArray().then((function(t){t.forEach((function(t){e.notes.set(t.id,t),Object(f.e)(t)}));var n=JSON.parse(window.localStorage.getItem("notes-order")),o=JSON.parse(window.localStorage.getItem("deleted-notes")),r=JSON.parse(window.localStorage.getItem("notes-ever-deleted"));e.notesOrder=n||Object(c.a)(e.notes.keys()),o&&S(o),r&&(e.notesEverDeleted=r),me(e)}));var t=window.localStorage.getItem("dark-mode");t&&ge("true"===t)}),[]),Object(d.useEffect)((function(){var e=Object(a.a)({},g);ye(e),b(e)}),[A]),Object(d.useEffect)((function(){var e=Object(a.a)({},g);ke(e),b(e)}),[w]),Object(d.useEffect)((function(){de=!1,o&&l&&(de=!0,T(se))}),[o,l]),Object(d.useEffect)((function(){le=ae,o&&l&&ae&&Ie()}),[ae,o,l]);var Ie=function(){g.checkedAgainstDrive&&(console.log("synching"),g.checkedAgainstDrive=!1,function(e,t,n,o,r,i){i||(i=0);var c=new Map;c.configFound=!1,c.finishedProcesses=0,c.mightNeedUpdate=!0,F(e,c,t,n,o,r)}(Object(a.a)({},g),y,S,we,me))},je=function(){var e=Object(i.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:j(t,n,we);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),me=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ke(t),ye(t),U(t),b(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ke=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(t,w);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J(t,A,we);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Se=function(){var e=Object(i.a)(r.a.mark((function e(){var t,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)({},g),n=Object(f.g)(),t.notesOrder=[n.id].concat(Object(c.a)(t.notesOrder)),window.localStorage.setItem("notes-order",JSON.stringify(t.notesOrder)),t.notes.set(n.id,n),t.selectedNoteId=n.id,t.openedCollectionId&&((o=t.notes.get(t.openedCollectionId)).collection.push(n.id),je(o,"meta")),fe.notes.put(n),je(n,"meta"),de&&x(t),me(t),ee("editor");case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=function(){var e=Object(i.a)(r.a.mark((function e(t,n,o){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(a.a)({},g),"get-occurrences"===n&&De(i),i.notes.set(t.id,t),i.selectedNoteId=t.id,o&&Me(t,i),je(t,"both"),me(i);case 7:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}(),Ne=function(){var e=Object(i.a)(r.a.mark((function e(t,n,o){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o||(o=Object(a.a)({},g)),Q(t,n,o,B,z,y,S,we,me),B&&z(!1);case 3:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}(),Ee=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$(g,b,B,R,L,A,w,we,me,t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pe=function(){var e=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.openedWorkspaceId?alert(h.d):R?((t=Object(a.a)({},g)).workspaceIds=Object(c.a)(new Set(Object(c.a)(t.workspaceIds))),U(t),b(t),L(!1)):L(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_(t,B,z,g,b,ye,Ae);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ae=function(){var e=Object(i.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X(t,n,z,g,we,R,me,Ne);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ce=function(){var e=Object(i.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n||(n=Object(a.a)({},g)),Y(t,n,we,R),t||me(n);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),De=function(){var e=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ce(!0,t),t.workspaceIds=g.notesOrder.filter((function(e){return g.notes.get(e).thread.includes(g.selectedNoteId)||g.notes.get(e).collection.includes(g.selectedNoteId)})),L(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=function(){var e=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(g);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fe=function(){var e=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.notes.get(g.selectedNoteId).then((function(e){g.notes.set(g.selectedNoteId,e),ee("editor")}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Re=function(){var e=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=Object(a.a)({},g)).openedCollectionId=null,ke(t),b(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(e,t){var n=!1;t||(n=!0,t=Object(a.a)({},g)),t.notesOrder=Object(f.h)(t.notesOrder,t.notesOrder.findIndex((function(t){return t===e.id})),t.notesOrder.length-1),n&&(M(t,w),b(t))};return Object(te.jsxs)("div",{children:["notes"===Z&&Object(te.jsx)(d.Suspense,{fallback:f.k,children:Object(te.jsx)(re,{darkMode:pe,dashboard:g,handleOnDragEnd:Ee,GAPIloaded:o,currentUser:l,setCurrentPage:ee,notesUpdating:Oe,setDarkMode:ge,closeCollection:Re,addNote:Se,selectNote:Te,mergeMode:B,setMergeMode:z,openEditor:Fe,rootsOrBranches:A,closeAndSave:Ce,threadOrCollection:R,threadOrCollectionManage:Pe,setRootsOrBranches:C,searchProps:w,setSearchProps:I,synchNotes:Ie})}),"editor"===Z&&g.selectedNoteId&&Object(te.jsx)(d.Suspense,{fallback:f.k,children:Object(te.jsx)(ne,{setCurrentPage:ee,selectedNote:g.notes.get(g.selectedNoteId),updateNote:xe,deleteNote:Ne,darkMode:pe,exportThread:We,threadCollectionSwap:function(e){var t,n=Object(a.a)({},g),o=n.notes.get(n.selectedNoteId);e?((t=o).collection=Object(c.a)(new Set(Object(c.a)(t.thread))),t.thread=[]):(!function(e){e.thread=e.collection,e.collection=[]}(o),K(n,o.thread,we),n.openedCollectionId===n.selectedNoteId&&(n.openedCollectionId=null)),n.openedWorkspaceId===n.selectedNoteId&&L(!R),me(n),je(o,"meta"),ee("notes")},moveToTheEnd:Me})}),Object(te.jsx)("iframe",{title:"printer",id:"ifmcontentstoprint",style:{height:"0px",width:"0px",position:"absolute",border:"0"}}),"settings"===Z&&Object(te.jsx)(d.Suspense,{fallback:f.k,children:Object(te.jsx)(oe,{setCurrentPage:ee,signInFunction:t,signOutFunction:n,loadedUser:l,GAPIloaded:o})})]})}},3:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"i",(function(){return f})),n.d(t,"h",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"c",(function(){return g})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return v})),n.d(t,"g",(function(){return O})),n.d(t,"j",(function(){return w})),n.d(t,"k",(function(){return I})),n.d(t,"b",(function(){return j}));var o=n(5),r=n(0),i=n(33),c=n(23),a=n(35),s=n.n(a),d=(n(1),n(9)),l=n(88);function u(e,t,n){return[].concat(Object(r.a)(e.slice(0,t)),[n],Object(r.a)(e.slice(t)))}function f(e,t){return[].concat(Object(r.a)(e.slice(0,t)),Object(r.a)(e.slice(t+1)))}function h(e,t,n){var o=f(e,t),i=e[t];return o=[].concat(Object(r.a)(o.slice(0,n)),[i],Object(r.a)(o.slice(n)))}function p(e){var t,n,o=e.preview.replace("<br/>","<br>");return t=o.split("<br>")[0].replace(/<[^>]*>?/gm,""),n=100,t.substr(0,n-1)+(t.length>n?"...":"")}function g(e,t){return e.notesOrder.reduce((function(n,o){return n&&!e.notes.get(o).thread.includes(t)&&!e.notes.get(o).branches.includes(t)}),!0)}function b(e){return{ui_id:Object(i.a)(),id:e.id,text:e.text,preview:e.preview,branches:e.branches,roots:e.roots,thread:e.thread,collection:e.collection,pinned:e.pinned,color:e.color,colorPreview:e.colorPreview,attachedImg:e.attachedImg}}function v(e){if(e.attachedImg.length){var t=Object(o.a)(e.attachedImg,3),n=t[0],r=t[1];t[2]&&e.text.length>r-n&&(e.text=e.text.substring(n,r).split('"')[0])}else delete e.text}function O(){return{id:Object(i.a)(),text:"",preview:"",branches:[],roots:[],thread:[],collection:[],pinned:!1,color:"#ffffff",colorPreview:"#ffffff",attachedImg:!1,version:0}}function w(e){var t=/<img src=.*?>/gm.exec(e.text);if(t){var n=""===e.text.substring(0,t.index).replace(/(<([^>]+)>)|(\s|(&nbsp))*/gm,"");e.attachedImg=[t.index+10,t.index+t[0].length,n]}else e.attachedImg=!1;var o=l.default(e.text.replace(/<p><br\/><\/p>|<p>(\s|(&nbsp))*<\/p>|<img .*?>/gm,""),c.b,{ellipsis:"..."});""===o.replace(/(<([^>]+)>)/gi,"")&&(o=e.attachedImg?"image only note":"empty note kept for its links"),e.preview=o}var I=Object(d.jsx)("div",{style:{justifyContent:"center",display:"flex"},children:Object(d.jsx)(s.a,{type:"ThreeDots",color:"#c6c6c6",height:50,width:50,style:{marginTop:"25%"}})});function j(e,t){var n=!1;if(e.length!==t.length)n=!0;else for(var o=0;o<e.length;o++)e[o]!==t[o]&&(n=!0);return n}},65:function(e,t,n){},8:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"j",(function(){return c})),n.d(t,"f",(function(){return a})),n.d(t,"m",(function(){return s})),n.d(t,"g",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"n",(function(){return u})),n.d(t,"e",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"l",(function(){return p})),n.d(t,"k",(function(){return g})),n.d(t,"h",(function(){return b}));var o="cannot insert a note inside its own Thread or Collection",r="Please close your workspace before changing between Thread Mode and Collection Mode.",i="Character limit reached. Additional content will not be saved. Please start a new note instead.",c="Merge Mode is on, please select another card to merge to the pink card. The content, links and references of the card you select will be copied. If you want to exit it, press the button again.",a="Google Drive is not connected. Please Login from the Settings page to allow the backup.",s="------------------------------------------------------------ new note ---------------------------------------------------",d="--------------------------------------------------------- exported thread -------------------------------------------\n",l="Merge Mode is on. Please finish merging or exit the Merge Mode before doing anything else.",u="Workspace length limit reached. Please save and start a new Workspace instead.",f="The note you want to delete compares in the branches of other notes. If you proceed, the system will automatically redirect the links of the other notes to preserve the connectivity. Otherwise, please restructure your links manually until this alert disappears.",h="The number of links of the resulting note would exceed the limit. Please remove some links to continue.",p="The size of the Thread or Collection of the resulting note would exceed the limit. Please remove some notes manually to continue.",g="The size of the resulting text exceeds the limit. Please shorten some text to continue.",b="Both the cards contain a Thread or a Collection and this generates a conflict in the mergin process. Please empty the Thread or Collection of one of the two notes and try again."}},[[146,3,4]]]);
//# sourceMappingURL=main.6221b0e9.chunk.js.map